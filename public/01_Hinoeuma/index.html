<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary SEO Meta Tags -->
    <title>Hinoeuma: Generative Dark Techno DJ Toolbox | Los Asbestos | Year of the Fire Horse 2026-2027</title>
    <meta name="title" content="Hinoeuma: Generative Dark Techno DJ Toolbox | Los Asbestos | Year of the Fire Horse 2026-2027">
    <meta name="description" content="Professional generative dark techno DJ toolbox by Los Asbestos with 22 performance knobs, lossless 320kHz recording, and advanced audio effects. Experience Hinoeuma - the rare Fire Horse Year combination that occurs once every 60 years.">
    <meta name="keywords" content="Los Asbestos, Hinoeuma, generative techno, dark techno, DJ toolbox, audio synthesizer, web audio API, Fire Horse Year, 2026, 2027, electronic music, music production, audio effects, lossless recording, Web Audio API, music technology">
    <meta name="author" content="Los Asbestos">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://losasbestos.com/">
    
    <!-- Alternate Languages (if applicable) -->
    <link rel="alternate" hreflang="en" href="https://losasbestos.com/">
    <link rel="alternate" hreflang="x-default" href="https://losasbestos.com/">
    
    <!-- DNS Prefetch and Preconnect -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#ff5500">
    <meta name="msapplication-TileColor" content="#ff5500">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://losasbestos.com/">
    <meta property="og:title" content="Hinoeuma: Generative Dark Techno DJ Toolbox | Los Asbestos">
    <meta property="og:description" content="Professional generative dark techno DJ toolbox by Los Asbestos with 22 performance knobs, lossless 320kHz recording, and advanced audio effects. Experience Hinoeuma - the rare Fire Horse Year combination.">
    <meta property="og:site_name" content="Los Asbestos">
    <meta property="og:locale" content="en_US">
    <meta property="og:image" content="https://losasbestos.com/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Hinoeuma - Generative Dark Techno DJ Toolbox by Los Asbestos">
    <meta property="og:image:type" content="image/png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://losasbestos.com/">
    <meta name="twitter:title" content="Hinoeuma: Generative Dark Techno DJ Toolbox | Los Asbestos">
    <meta name="twitter:description" content="Professional generative dark techno DJ toolbox by Los Asbestos with 22 performance knobs, lossless 320kHz recording, and advanced audio effects.">
    <meta name="twitter:image" content="https://losasbestos.com/twitter-image.png">
    <meta name="twitter:image:alt" content="Hinoeuma - Generative Dark Techno DJ Toolbox by Los Asbestos">
    <meta name="twitter:site" content="@losasbestos">
    <meta name="twitter:creator" content="@losasbestos">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Hinoeuma: Generative Dark Techno DJ Toolbox",
        "alternateName": "Hinoeuma",
        "description": "Professional generative dark techno DJ toolbox by Los Asbestos with 22 performance knobs, lossless 320kHz recording, and advanced audio effects. Experience the rare Fire Horse Year combination that occurs once every 60 years.",
        "url": "https://losasbestos.com/",
        "applicationCategory": "MusicApplication",
        "operatingSystem": "Web Browser",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "Los Asbestos",
            "url": "https://losasbestos.com/"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Los Asbestos",
            "url": "https://losasbestos.com/"
        },
        "inLanguage": "en-US",
        "license": "https://losasbestos.com/",
        "featureList": [
            "22 Performance Knobs",
            "Lossless 320kHz/32-bit Recording",
            "Professional DJ Effects",
            "Real-time Audio Synthesis",
            "Jungle Ambience Controls",
            "Web Audio API Integration",
            "Voice Recording",
            "Professional EQ and Filters"
        ],
        "screenshot": "https://losasbestos.com/og-image.png",
        "softwareVersion": "1.0",
        "datePublished": "2026-01-01",
        "dateModified": "2026-01-01"
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "MusicComposition",
        "name": "Hinoeuma",
        "composer": {
            "@type": "Organization",
            "name": "Los Asbestos"
        },
        "inAlbum": {
            "@type": "MusicAlbum",
            "name": "Hinoeuma",
            "byArtist": {
                "@type": "Organization",
                "name": "Los Asbestos"
            }
        },
        "url": "https://losasbestos.com/"
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Los Asbestos",
        "url": "https://losasbestos.com/",
        "logo": "https://losasbestos.com/logo.png",
        "sameAs": [
            "https://twitter.com/losasbestos",
            "https://github.com/losasbestos"
        ],
        "description": "Los Asbestos - Electronic music producer and developer creating innovative generative music tools"
    }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;500;600&family=Spectral:ital,wght@0,300;0,400;1,300&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 1999 Cartoon Colors - Bold & Playful */
            --parchment: #f4ede4;
            --parchment-dark: #e8dfd3;
            --ink: #1a1a1a;
            --fire-orange: #ff5500;
            --fire-gold: #ffcc00;
            --fire-red: #ff3333;
            --ember: #ff6b35;
            --cartoon-purple: #cc00ff;
            --cartoon-cyan: #00ffff;
            --cartoon-green: #00ff88;
            
            /* 2050 Ultra-Realistic - Depth & Holographic */
            --deep-night: #0a0d12;
            --mystic-blue: #00d4ff;
            --thorn: #1a1f2e;
            --holographic-pink: #ff00c8;
            --holographic-blue: #0099ff;
            --metallic-silver: #c8d0e0;
            --metallic-gold: #ffd700;
            
            /* 3D Depth Shadows (2050) */
            --shadow-deep: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);
            --shadow-holographic: 0 0 30px rgba(0, 212, 255, 0.4), 0 0 60px rgba(255, 0, 200, 0.2);
            --shadow-cartoon: 0 8px 0 rgba(0, 0, 0, 0.3), 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 24px; /* Much larger base font size */
        }

        body {
            min-height: 100vh;
            /* 1999 Cartoon + 2050 Realistic Blend */
            background: 
                radial-gradient(ellipse at 20% 50%, rgba(255, 204, 0, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 50%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, #f4ede4 0%, #e8dfd3 50%, #f0e8dc 100%);
            font-family: 'Spectral', Georgia, serif;
            color: var(--ink);
            overflow-x: hidden; /* Prevent horizontal scrolling */
            position: relative;
            width: 100%;
            max-width: 100vw;
        }
        
        /* 2050 Holographic overlay effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(0, 212, 255, 0.03) 50%, transparent 70%),
                linear-gradient(-45deg, transparent 30%, rgba(255, 0, 200, 0.03) 50%, transparent 70%);
            pointer-events: none;
            z-index: 1;
            animation: holographicShift 8s ease-in-out infinite;
        }
        
        @keyframes holographicShift {
            0%, 100% { opacity: 1; transform: translateX(0); }
            50% { opacity: 0.8; transform: translateX(20px); }
        }

        /* Animated Background Texture */
        .texture-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Main Container - Full Screen Layout */
        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding: 0;
            position: relative;
            width: 100%;
        }

        /* App Content Area - Contains player and controls */
        .app-content {
            display: flex;
            flex-direction: row;
            flex: 1;
            align-items: stretch;
            position: relative;
        }

        /* Player Section - Integrated into app */
        .player-section {
            position: relative;
            background: rgba(0, 0, 0, 0.95);
            padding: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            border-bottom: 2px solid var(--fire-gold);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 100%;
        }

        /* World Canvas - Center Area */
        .world-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, 
                rgba(26, 32, 48, 0.95) 0%, 
                rgba(30, 40, 60, 0.9) 50%,
                rgba(20, 30, 45, 0.95) 100%);
            z-index: 1;
        }

        /* Side Panels for Knobs */
        .knobs-panel {
            width: 280px; /* Fixed width for side panels */
            background: linear-gradient(135deg, rgba(42, 42, 58, 0.98) 0%, rgba(26, 26, 42, 0.98) 100%);
            border: 4px solid var(--cartoon-cyan);
            box-shadow: 
                0 0 40px rgba(0, 0, 0, 0.8),
                inset 0 0 60px rgba(0, 212, 255, 0.1);
            padding: 2rem 1.5rem;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            z-index: 100;
        }

        .knobs-panel-left {
            border-right: 6px solid var(--fire-gold);
        }

        .knobs-panel-right {
            border-left: 6px solid var(--fire-gold);
        }

        .knobs-panel::-webkit-scrollbar {
            width: 12px;
        }

        .knobs-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        .knobs-panel::-webkit-scrollbar-thumb {
            background: var(--fire-gold);
            border-radius: 6px;
        }

        /* Thorny Border Frame */
        .border-frame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .thorn-border {
            position: absolute;
            background: linear-gradient(135deg, var(--thorn) 0%, #1a1a1a 50%, var(--mystic-blue) 100%);
            opacity: 0.9;
        }

        .thorn-top, .thorn-bottom {
            height: 25px;
            left: 0;
            right: 0;
        }

        .thorn-top {
            top: 0;
            clip-path: polygon(0 0, 100% 0, 100% 60%, 98% 100%, 95% 50%, 92% 100%, 88% 40%, 85% 100%, 80% 50%, 75% 100%, 70% 40%, 65% 100%, 60% 50%, 55% 100%, 50% 40%, 45% 100%, 40% 50%, 35% 100%, 30% 40%, 25% 100%, 20% 50%, 15% 100%, 10% 40%, 5% 100%, 2% 50%, 0 100%);
            animation: thornPulse 4s ease-in-out infinite;
        }

        .thorn-bottom {
            bottom: 0;
            clip-path: polygon(0 100%, 100% 100%, 100% 40%, 98% 0%, 95% 50%, 92% 0%, 88% 60%, 85% 0%, 80% 50%, 75% 0%, 70% 60%, 65% 0%, 60% 50%, 55% 0%, 50% 60%, 45% 0%, 40% 50%, 35% 0%, 30% 60%, 25% 0%, 20% 50%, 15% 0%, 10% 60%, 5% 0%, 2% 50%, 0 0%);
            animation: thornPulse 4s ease-in-out infinite 0.5s;
        }

        .thorn-left, .thorn-right {
            width: 25px;
            top: 0;
            bottom: 0;
        }

        .thorn-left {
            left: 0;
            clip-path: polygon(0 0, 60% 0, 100% 2%, 50% 5%, 100% 10%, 40% 15%, 100% 20%, 50% 25%, 100% 30%, 40% 35%, 100% 40%, 50% 45%, 100% 50%, 40% 55%, 100% 60%, 50% 65%, 100% 70%, 40% 75%, 100% 80%, 50% 85%, 100% 90%, 40% 95%, 100% 98%, 60% 100%, 0 100%);
            animation: thornPulse 4s ease-in-out infinite 0.25s;
        }

        .thorn-right {
            right: 0;
            clip-path: polygon(100% 0, 40% 0, 0% 2%, 50% 5%, 0% 10%, 60% 15%, 0% 20%, 50% 25%, 0% 30%, 60% 35%, 0% 40%, 50% 45%, 0% 50%, 60% 55%, 0% 60%, 50% 65%, 0% 70%, 60% 75%, 0% 80%, 50% 85%, 0% 90%, 60% 95%, 0% 98%, 40% 100%, 100% 100%);
            animation: thornPulse 4s ease-in-out infinite 0.75s;
        }

        @keyframes thornPulse {
            0%, 100% { opacity: 0.85; }
            50% { opacity: 1; }
        }

        /* Corner Decorations */
        .corner {
            position: absolute;
            width: 80px;
            height: 80px;
            opacity: 0.7;
        }

        .corner svg {
            width: 100%;
            height: 100%;
            fill: var(--mystic-blue);
            filter: drop-shadow(0 0 10px rgba(74, 158, 173, 0.5));
        }

        .corner-tl { top: 15px; left: 15px; }
        .corner-tr { top: 15px; right: 15px; transform: rotate(90deg); }
        .corner-bl { bottom: 15px; left: 15px; transform: rotate(-90deg); }
        .corner-br { bottom: 15px; right: 15px; transform: rotate(180deg); }

        /* Main Card - 2050 Depth + 1999 Cartoon Blend */
        .main-card {
            /* 1999 Cartoon: Bold border, rounded corners */
            background: 
                linear-gradient(135deg, #f4ede4 0%, #ffffff 50%, #f4ede4 100%);
            border: 5px solid var(--fire-orange);
            border-radius: 25px;
            /* 2050 Ultra-Realistic: Deep 3D shadows, holographic glows */
            box-shadow: 
                0 0 0 2px var(--cartoon-cyan),
                0 0 0 6px rgba(0, 212, 255, 0.3),
                0 25px 80px rgba(0, 0, 0, 0.4),
                0 0 100px rgba(0, 212, 255, 0.15),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            padding: 2.5rem 2rem;
            position: relative;
            z-index: 10;
            /* 1999 Cartoon: Playful floating animation */
            animation: cardFloat 6s ease-in-out infinite;
            /* 2050 Realistic: Subtle 3D transform */
            transform-style: preserve-3d;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .main-card:hover {
            /* 2050 Holographic glow on hover */
            box-shadow: 
                0 0 0 2px var(--cartoon-cyan),
                0 0 0 6px rgba(0, 212, 255, 0.5),
                0 30px 100px rgba(0, 0, 0, 0.5),
                0 0 150px rgba(0, 212, 255, 0.25),
                0 0 80px rgba(255, 0, 200, 0.15),
                inset 0 2px 4px rgba(255, 255, 255, 0.6);
        }

        @keyframes cardFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .header h1 {
            font-family: 'Cinzel Decorative', serif;
            font-size: 1.6rem;
            font-weight: 400;
            letter-spacing: 0.1em;
            color: var(--ink);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
            50% { text-shadow: 2px 2px 20px rgba(232, 90, 27, 0.3), 2px 2px 4px rgba(0,0,0,0.1); }
        }

        /* Scroll Dates */
        .scroll-dates {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .scroll-handle {
            width: 20px;
            height: 80px;
            background: linear-gradient(180deg, #5a6066 0%, #3d4145 50%, #5a6066 100%);
            border-radius: 4px;
            position: relative;
            z-index: 2;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
        }

        .scroll-handle::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 28px;
            height: 16px;
            background: linear-gradient(180deg, #6a7076 0%, #4d5155 100%);
            border-radius: 4px 4px 0 0;
        }

        .scroll-handle::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 28px;
            height: 16px;
            background: linear-gradient(180deg, #4d5155 0%, #6a7076 100%);
            border-radius: 0 0 4px 4px;
        }

        .scroll-paper {
            background: linear-gradient(180deg, #d4cdc4 0%, #e8e0d6 20%, #e8e0d6 80%, #d4cdc4 100%);
            padding: 0.8rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 120px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .scroll-paper .label {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            color: #666;
            text-transform: uppercase;
        }

        .scroll-paper .date {
            font-family: 'Cinzel', serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--ink);
            margin-top: 0.2rem;
        }

        /* Horse Illustration Container - Full World Canvas */
        .horse-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: linear-gradient(180deg, var(--deep-night) 0%, #1a2030 100%);
            overflow: hidden;
        }

        /* World Background Effects - Audio Reactive */
        .world-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 204, 0, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(232, 90, 27, 0.1) 0%, transparent 60%);
            pointer-events: none;
            z-index: 1;
            transition: opacity 0.3s ease, filter 0.3s ease;
        }

        .world-container.audio-active::before {
            opacity: 1.2;
            filter: brightness(1.1);
        }

        .world-container.bass-active::before {
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 204, 0, 0.25) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.25) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(232, 90, 27, 0.2) 0%, transparent 60%);
            animation: bassPulse 0.5s ease-out;
        }

        @keyframes bassPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 1.3; transform: scale(1.05); }
        }

        .world-container.distortion-active::before {
            filter: hue-rotate(20deg) brightness(1.2);
            animation: distortionShift 2s ease-in-out infinite;
        }

        @keyframes distortionShift {
            0%, 100% { filter: hue-rotate(20deg) brightness(1.2); }
            50% { filter: hue-rotate(40deg) brightness(1.4); }
        }

        .world-container.jungle-active::before {
            background: 
                radial-gradient(circle at 20% 30%, rgba(34, 139, 34, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 128, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(232, 90, 27, 0.15) 0%, transparent 60%);
            animation: jungleSway 8s ease-in-out infinite;
        }

        @keyframes jungleSway {
            0%, 100% { transform: translateX(0) translateY(0); }
            33% { transform: translateX(2%) translateY(-1%); }
            66% { transform: translateX(-2%) translateY(1%); }
        }

        /* Audio Reactive Particles */
        .world-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            overflow: hidden;
        }

        .world-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--fire-gold);
            opacity: 0.6;
            animation: particleFloat 4s ease-in-out infinite;
        }

        @keyframes particleFloat {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) translateX(20px); opacity: 0; }
        }

        /* Animated Stars */
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Fire Horse SVG - Floating Bottom Right (Dragon) */
        .horse-svg {
            position: fixed;
            width: 200px;
            height: 200px;
            bottom: 20px;
            right: 20px;
            transform: none;
            animation: horseGlow 2s ease-in-out infinite;
            transition: transform 0.3s ease, filter 0.2s ease;
            z-index: 9999;
            pointer-events: none;
        }

        /* Enhanced wandering with variable duration based on audio */
        .horse-svg.wandering {
            animation: horseGlow 2s ease-in-out infinite;
        }

        .horse-svg.wandering-fast {
            animation: horseGlow 2s ease-in-out infinite;
        }

        .horse-svg.wandering-slow {
            animation: horseGlow 2s ease-in-out infinite;
        }

        @keyframes horseGlow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(232, 90, 27, 0.6)); }
            50% { filter: drop-shadow(0 0 40px rgba(244, 166, 54, 0.8)); }
        }

        /* Fire Particles */
        .fire-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireRise 2s ease-out infinite;
        }

        @keyframes fireRise {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(0);
            }
        }

        /* Badge */
        .badge {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .badge-inner {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at 30% 30%, var(--fire-red) 0%, #8b1a1a 100%);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--fire-gold);
            box-shadow: 
                0 0 20px rgba(232, 90, 27, 0.5),
                inset 0 0 20px rgba(0,0,0,0.3);
            animation: badgePulse 2s ease-in-out infinite;
        }

        @keyframes badgePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(232, 90, 27, 0.5), inset 0 0 20px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 0 40px rgba(244, 166, 54, 0.7), inset 0 0 20px rgba(0,0,0,0.3); }
        }

        .badge-text {
            font-family: 'Cinzel Decorative', serif;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--fire-gold);
            text-align: center;
            line-height: 1.1;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .badge-sub {
            font-family: 'Cinzel', serif;
            font-size: 0.5rem;
            color: rgba(244, 166, 54, 0.8);
            letter-spacing: 0.05em;
            margin-top: 0.3rem;
        }

        /* Wave Decorations */
        .wave-decoration {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
        }

        .wave-circle {
            width: 50px;
            height: 50px;
            border: 2px solid var(--mystic-blue);
            border-radius: 50%;
            position: relative;
            opacity: 0.6;
        }

        .wave-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 1px solid var(--mystic-blue);
            border-radius: 50%;
        }

        /* Tagline */
        .tagline {
            text-align: center;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            letter-spacing: 0.2em;
            color: var(--ink);
            text-transform: uppercase;
            margin-bottom: 2rem;
        }

        /* Generative Audio Player - 2050/1999 Blend */
        .audio-player {
            /* Pioneer-style boxed design */
            background: 
                linear-gradient(180deg, #1a1f2e 0%, #0a0d12 100%);
            border: 2px solid rgba(0, 212, 255, 0.4);
            border-radius: 8px;
            padding: 0.6rem;
            margin-top: 0.4rem;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.05);
            /* 2050 Realistic: Deep 3D shadows, holographic glows */
            box-shadow: 
                0 0 0 2px rgba(0, 255, 255, 0.3),
                0 20px 60px rgba(0, 0, 0, 0.6),
                0 0 80px rgba(0, 212, 255, 0.2),
                inset 0 2px 8px rgba(255, 255, 255, 0.1),
                inset 0 -2px 8px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .audio-player::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* 2050 Holographic glow overlay */
            background: 
                radial-gradient(ellipse at 30% 50%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 50%, rgba(255, 0, 200, 0.15) 0%, transparent 50%);
            pointer-events: none;
            animation: holographicPulse 4s ease-in-out infinite;
        }
        
        @keyframes holographicPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.4rem;
            position: relative;
            z-index: 1;
        }

        .play-btn {
            /* 1999 Cartoon: Bold colors, chunky size */
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--fire-orange) 0%, var(--fire-red) 100%);
            border: 3px solid var(--cartoon-cyan);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
            /* 2050 Realistic: Deep shadows, holographic glow */
            box-shadow: 
                0 8px 0 rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(255, 85, 0, 0.6),
                0 0 40px rgba(255, 85, 0, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2);
        }

        .play-btn:hover {
            /* 1999 Cartoon: Playful scale bounce */
            transform: scale(1.1) translateY(-2px);
            /* 2050 Realistic: Enhanced holographic glow */
            box-shadow: 
                0 10px 0 rgba(0, 0, 0, 0.4),
                0 6px 20px rgba(255, 85, 0, 0.8),
                0 0 60px rgba(255, 85, 0, 0.6),
                0 0 40px rgba(0, 255, 255, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
        }

        .play-btn.playing {
            background: linear-gradient(135deg, var(--mystic-blue) 0%, var(--holographic-pink) 100%);
            border-color: var(--cartoon-purple);
            box-shadow: 
                0 8px 0 rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(0, 212, 255, 0.7),
                0 0 50px rgba(0, 212, 255, 0.5),
                0 0 30px rgba(255, 0, 200, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            animation: playingPulse 2s ease-in-out infinite;
        }
        
        @keyframes playingPulse {
            0%, 100% { box-shadow: 0 8px 0 rgba(0, 0, 0, 0.4), 0 4px 16px rgba(0, 212, 255, 0.7), 0 0 50px rgba(0, 212, 255, 0.5), 0 0 30px rgba(255, 0, 200, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 8px 0 rgba(0, 0, 0, 0.4), 0 4px 16px rgba(0, 212, 255, 0.9), 0 0 70px rgba(0, 212, 255, 0.7), 0 0 50px rgba(255, 0, 200, 0.6), inset 0 2px 4px rgba(255, 255, 255, 0.4); }
        }

        .play-btn svg {
            width: 22px;
            height: 22px;
            fill: white;
        }

        .play-icon { margin-left: 3px; }
        .pause-icon { display: none; }
        .play-btn.playing .play-icon { display: none; }
        .play-btn.playing .pause-icon { display: block; }

        .track-info {
            flex: 1;
        }

        .track-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--parchment);
            margin-bottom: 0.25rem;
            letter-spacing: 0.05em;
        }

        .track-artist {
            font-family: 'Spectral', serif;
            font-size: 0.85rem;
            color: var(--mystic-blue);
            font-style: italic;
        }

        /* Visualizer */
        .visualizer-container {
            position: relative;
            height: 45px;
            margin-bottom: 0.4rem;
            border-radius: 6px;
            overflow: hidden;
            background: rgba(0,0,0,0.3);
        }

        .visualizer {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            padding: 8px;
        }

        .viz-bar {
            flex: 1;
            max-width: 8px;
            background: linear-gradient(180deg, var(--fire-gold) 0%, var(--fire-orange) 50%, var(--fire-red) 100%);
            border-radius: 2px 2px 0 0;
            min-height: 3px;
            transition: height 0.05s ease;
        }

        /* Controls */
        .controls-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .volume-icon {
            width: 18px;
            height: 18px;
            fill: var(--mystic-blue);
            flex-shrink: 0;
        }

        .slider {
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: var(--fire-gold);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(244, 166, 54, 0.5);
        }

        .volume-slider { width: 80px; }

        .tempo-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }

        .tempo-label {
            font-family: 'Spectral', serif;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
        }

        .tempo-slider { width: 70px; }

        .tempo-value {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: var(--fire-gold);
            min-width: 45px;
        }

        /* Status indicator */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            margin-left: auto;
        }

        .status-dot.active {
            background: var(--fire-gold);
            box-shadow: 0 0 10px var(--fire-gold);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Professional DJ Toolbox - EQ & Filters */
        .dj-toolbox {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.3rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .controls-knobs-section {
            margin-top: 0.3rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .controls-knobs-section .knobs-section-title {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: var(--cartoon-cyan);
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .controls-knobs-section .knob-group {
            margin-bottom: 1rem;
        }

        .controls-knobs-section .knob-group:last-child {
            margin-bottom: 0;
        }

        .controls-knobs-section .knob-group-title {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            color: var(--fire-gold);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            padding-left: 0.5rem;
            border-left: 2px solid var(--fire-gold);
        }

        .controls-knobs-section .knob-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
        }

        .controls-knobs-section .knob-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 0;
        }

        .controls-knobs-section .knob {
            width: 50px;
            height: 50px;
            position: relative;
        }

        .controls-knobs-section .knob-indicator {
            position: absolute;
            width: 8px;
            height: 20px;
            background: linear-gradient(180deg, var(--fire-gold) 0%, var(--fire-orange) 100%);
            border-radius: 4px;
            top: 5px;
            left: 50%;
            transform-origin: center bottom;
            transform: translateX(-50%) rotate(0deg);
            box-shadow: 
                0 0 6px rgba(255, 204, 0, 0.8),
                0 0 12px rgba(255, 85, 0, 0.4),
                inset 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .controls-knobs-section .knob-ring {
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            border: 1px solid transparent;
            background: conic-gradient(
                from 225deg,
                transparent 0deg,
                var(--fire-red) 0deg,
                var(--fire-gold) 30deg,
                var(--cartoon-cyan) 60deg,
                var(--holographic-pink) 90deg,
                var(--cartoon-purple) 120deg,
                var(--fire-gold) var(--knob-progress, 0deg),
                transparent var(--knob-progress, 0deg)
            );
            mask: radial-gradient(circle, transparent 21px, black 22px, black 25px, transparent 26px);
            -webkit-mask: radial-gradient(circle, transparent 21px, black 22px, black 25px, transparent 26px);
            opacity: 0.9;
            pointer-events: none;
            filter: blur(0.5px);
        }

        .controls-knobs-section .knob-label {
            font-size: 0.55rem;
            margin-top: 0.3rem;
        }

        .controls-knobs-section .knob-value {
            font-size: 0.55rem;
            margin-top: 0.2rem;
        }

        .eq-section, .filter-section {
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(0, 212, 255, 0.25);
            border-radius: 6px;
            padding: 0.5rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            color: var(--cartoon-cyan);
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 0.4rem;
            text-transform: uppercase;
        }

        .eq-controls, .filter-controls {
            display: flex;
            justify-content: space-around;
            gap: 0.5rem;
        }

        .eq-band, .filter-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
            flex: 1;
        }

        .eq-label, .filter-label {
            font-family: 'Spectral', serif;
            font-size: 0.55rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        .eq-slider-container, .filter-slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 70px;
            position: relative;
        }

        .eq-slider, .filter-slider {
            -webkit-appearance: slider-vertical;
            writing-mode: bt-lr;
            width: 4px;
            height: 60px;
            background: linear-gradient(180deg, var(--fire-red) 0%, rgba(255,255,255,0.2) 50%, var(--cartoon-cyan) 100%);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            position: relative;
        }

        .eq-slider::-webkit-slider-thumb, .filter-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--fire-gold);
            border: 2px solid var(--cartoon-cyan);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.4),
                0 0 8px rgba(255, 204, 0, 0.6);
        }

        .eq-value, .filter-value {
            font-family: 'Cinzel', serif;
            font-size: 0.5rem;
            color: var(--fire-gold);
            min-width: 35px;
            text-align: center;
        }

        .filter-toggle {
            display: flex;
            gap: 0.3rem;
            margin-top: 0.3rem;
        }

        .filter-btn {
            flex: 1;
            padding: 0.3rem 0.4rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: rgba(255,255,255,0.6);
            font-family: 'Spectral', serif;
            font-size: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .filter-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--cartoon-cyan);
        }

        .filter-btn.active {
            background: rgba(0, 212, 255, 0.3);
            border-color: var(--cartoon-cyan);
            color: var(--cartoon-cyan);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.4);
        }

        /* Bottom Controls Row - Combined layout */
        .bottom-controls-row {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            margin-top: 0.3rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        /* Export Controls */
        .export-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            min-width: 200px;
            padding: 0.4rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Recording Controls - Legacy class for compatibility */
        .recording-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Social Sharing Section */
        .social-sharing {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding: 0.4rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .social-sharing-label {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-right: 0.3rem;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .social-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .social-btn svg {
            width: 18px;
            height: 18px;
            fill: var(--parchment);
        }

        .social-btn.twitter:hover {
            background: rgba(29, 161, 242, 0.3);
            border-color: rgba(29, 161, 242, 0.6);
            box-shadow: 0 4px 12px rgba(29, 161, 242, 0.3);
        }

        .social-btn.twitter svg {
            fill: #1da1f2;
        }

        .social-btn.facebook:hover {
            background: rgba(24, 119, 242, 0.3);
            border-color: rgba(24, 119, 242, 0.6);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .social-btn.facebook svg {
            fill: #1877f2;
        }

        .social-btn.reddit:hover {
            background: rgba(255, 69, 0, 0.3);
            border-color: rgba(255, 69, 0, 0.6);
            box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
        }

        .social-btn.reddit svg {
            fill: #ff4500;
        }

        .social-btn.copy:hover {
            background: rgba(74, 158, 173, 0.3);
            border-color: rgba(74, 158, 173, 0.6);
            box-shadow: 0 4px 12px rgba(74, 158, 173, 0.3);
        }

        .social-btn.copy svg {
            fill: var(--mystic-blue);
        }

        .record-btn {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 0.5rem 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .record-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--fire-red);
        }

        .record-btn.recording {
            background: rgba(194, 58, 34, 0.3);
            border-color: var(--fire-red);
        }

        .record-btn.recording .record-icon {
            animation: recordPulse 1s ease-in-out infinite;
        }

        @keyframes recordPulse {
            0%, 100% { fill: var(--fire-red); }
            50% { fill: #ff6b6b; }
        }

        .record-icon {
            width: 14px;
            height: 14px;
            fill: var(--fire-red);
        }

        .record-label {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: var(--parchment);
            letter-spacing: 0.1em;
        }

        .record-info {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            flex: 1;
        }

        .record-status {
            font-family: 'Spectral', serif;
            font-size: 0.7rem;
            color: rgba(255,255,255,0.5);
        }

        .record-status.recording {
            color: var(--fire-red);
        }

        .record-time {
            font-family: 'Cinzel', serif;
            font-size: 0.85rem;
            color: var(--fire-gold);
            letter-spacing: 0.05em;
        }

        .record-sources {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .source-toggle {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            cursor: pointer;
            user-select: none;
            font-family: 'Spectral', serif;
            font-size: 0.65rem;
            color: rgba(255,255,255,0.7);
            transition: color 0.2s ease;
        }

        .source-toggle:hover {
            color: rgba(255,255,255,0.9);
        }

        .source-toggle input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
            accent-color: var(--mystic-blue);
        }

        .source-toggle input[type="checkbox"]:checked + span {
            color: var(--mystic-blue);
        }

        /* Track Mixer Styles */
        .track-mixer-title {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: var(--cartoon-cyan);
            letter-spacing: 0.1em;
            text-align: center;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .track-groups {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .track-group {
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(0, 212, 255, 0.25);
            border-radius: 6px;
            padding: 0.5rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .track-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .track-group-toggle {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
            user-select: none;
            font-family: 'Spectral', serif;
            font-size: 0.65rem;
            color: rgba(255,255,255,0.8);
            flex: 1;
        }

        .track-group-name {
            font-weight: 600;
        }

        .track-group-toggle input[type="checkbox"] {
            width: 14px;
            height: 14px;
            cursor: pointer;
            accent-color: var(--mystic-blue);
        }

        .track-group-toggle input[type="checkbox"]:checked + .track-group-name {
            color: var(--mystic-blue);
        }

        .track-group-volume {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            min-width: 100px;
        }

        .track-volume-slider {
            flex: 1;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .track-volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--mystic-blue);
            border-radius: 50%;
            cursor: pointer;
        }

        .track-volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--mystic-blue);
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .track-volume-value {
            font-family: 'Cinzel', serif;
            font-size: 0.6rem;
            color: var(--fire-gold);
            min-width: 30px;
            text-align: right;
        }

        .track-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.35rem;
            margin-top: 0.4rem;
        }

        .track-item {
            display: flex;
            align-items: center;
            padding: 0.35rem 0.5rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.15);
            border-radius: 4px;
            font-family: 'Spectral', serif;
            font-size: 0.6rem;
            color: rgba(255,255,255,0.7);
            transition: all 0.2s ease;
        }

        .track-item:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .track-item-toggle {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
            user-select: none;
            width: 100%;
        }

        .track-item-toggle input[type="checkbox"] {
            width: 12px;
            height: 12px;
            cursor: pointer;
            accent-color: var(--mystic-blue);
            flex-shrink: 0;
        }

        .track-item-toggle input[type="checkbox"]:checked + .track-item-name {
            color: var(--mystic-blue);
            font-weight: 600;
        }

        .track-item-name {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .track-item-volume {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            min-width: 80px;
        }

        .download-btn {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(74, 158, 173, 0.3) 0%, rgba(74, 158, 173, 0.1) 100%);
            border: 1px solid var(--mystic-blue);
            border-radius: 6px;
            padding: 0.5rem 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .download-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(74, 158, 173, 0.5) 0%, rgba(74, 158, 173, 0.2) 100%);
            box-shadow: 0 0 15px rgba(74, 158, 173, 0.3);
        }

        .download-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .download-btn svg {
            width: 16px;
            height: 16px;
            fill: var(--mystic-blue);
        }

        .download-btn span {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            color: var(--parchment);
            letter-spacing: 0.05em;
        }

        /* Quality indicator */
        .quality-badge {
            font-family: 'Spectral', serif;
            font-size: 0.5rem;
            color: rgba(0, 212, 255, 0.6);
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
            opacity: 0.8;
        }

        /* 
           KNOB CONTROLS - 22 Rotary Controllers
            */
        
        .knobs-section {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .knobs-section-title {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem; /* Much larger */
            color: var(--mystic-blue);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .knob-group {
            margin-bottom: 2rem;
        }

        .knob-group-title {
            font-family: 'Cinzel', serif;
            font-size: 0.95rem; /* Much larger */
            color: var(--fire-gold);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 1rem;
            padding-left: 0.5rem;
            border-left: 4px solid var(--fire-gold);
            font-weight: 600;
        }

        .knob-row {
            display: flex;
            flex-direction: column;
            gap: 0;
            justify-content: flex-start;
        }

        .knob-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 140px; /* Much larger */
            margin-bottom: 1.5rem;
        }

        .knob {
            /* 1999 Cartoon: Chunky size, bold border - MUCH LARGER */
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(145deg, #2a2a3a 0%, #1a1a2a 50%, #0d0d1a 100%);
            border: 3px solid var(--cartoon-cyan);
            position: relative;
            cursor: pointer;
            user-select: none;
            /* 2050 Realistic: Deep 3D shadows, metallic highlight */
            box-shadow: 
                0 4px 0 rgba(0, 0, 0, 0.4),
                0 8px 16px rgba(0, 0, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.1),
                inset 0 -2px 4px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 212, 255, 0.2);
            transition: all 0.2s ease;
        }

        .knob:hover {
            /* 1999 Cartoon: Playful scale */
            transform: scale(1.1) translateY(-2px);
            border-color: var(--fire-gold);
            /* 2050 Realistic: Enhanced holographic glow */
            box-shadow: 
                0 6px 0 rgba(0, 0, 0, 0.4),
                0 12px 24px rgba(0, 0, 0, 0.6),
                inset 0 2px 4px rgba(255, 255, 255, 0.15),
                inset 0 -2px 4px rgba(0, 0, 0, 0.3),
                0 0 40px rgba(0, 212, 255, 0.5),
                0 0 30px rgba(255, 204, 0, 0.3);
        }

        .knob:active {
            border-color: var(--cartoon-purple);
            transform: scale(1.05) translateY(0);
            box-shadow: 
                0 2px 0 rgba(0, 0, 0, 0.4),
                0 4px 12px rgba(0, 0, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.1),
                0 0 60px rgba(204, 0, 255, 0.6);
        }

        .knob-indicator {
            position: absolute;
            /* 1999 Cartoon: Chunky indicator - MUCH LARGER */
            width: 10px;
            height: 35px;
            background: linear-gradient(180deg, var(--fire-gold) 0%, var(--fire-orange) 100%);
            border-radius: 5px;
            top: 12px;
            left: 50%;
            transform-origin: center bottom;
            transform: translateX(-50%) rotate(0deg);
            /* 2050 Realistic: Holographic glow */
            box-shadow: 
                0 0 8px rgba(255, 204, 0, 0.8),
                0 0 16px rgba(255, 85, 0, 0.4),
                inset 0 0 4px rgba(255, 255, 255, 0.3);
        }

        .knob-ring {
            position: absolute;
            top: -12px;
            left: -12px;
            right: -12px;
            bottom: -12px;
            border-radius: 50%;
            border: 1px solid transparent;
            /* 1999 Cartoon: Bold colors + 2050 Realistic: Smooth gradient */
            background: conic-gradient(
                from 225deg,
                transparent 0deg,
                var(--fire-red) 0deg,
                var(--fire-gold) 30deg,
                var(--cartoon-cyan) 60deg,
                var(--holographic-pink) 90deg,
                var(--cartoon-purple) 120deg,
                var(--fire-gold) var(--knob-progress, 0deg),
                transparent var(--knob-progress, 0deg)
            );
            mask: radial-gradient(circle, transparent 55px, black 56px, black 62px, transparent 63px);
            -webkit-mask: radial-gradient(circle, transparent 55px, black 56px, black 62px, transparent 63px);
            opacity: 0.9;
            pointer-events: none;
            /* 2050 Realistic: Subtle glow */
            filter: blur(1px);
        }

        .knob-label {
            font-family: 'Spectral', serif;
            font-size: 0.85rem; /* Much larger */
            color: rgba(255,255,255,0.8);
            margin-top: 0.6rem;
            text-align: center;
            line-height: 1.2;
            max-width: 140px;
            word-wrap: break-word;
            font-weight: 500;
        }

        .knob-value {
            font-family: 'Cinzel', serif;
            font-size: 0.95rem; /* Much larger */
            color: var(--fire-gold);
            margin-top: 0.3rem;
            font-weight: 600;
        }

        /* Knob touch feedback */
        .knob.dragging {
            border-color: var(--fire-gold);
            box-shadow: 
                0 0 20px rgba(244, 166, 54, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.05);
        }

        .knob.dragging .knob-indicator {
            background: #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        /* Responsive knob grid */
        @media (max-width: 500px) {
            .knob-container {
                width: 48px;
            }
            .knob {
                width: 38px;
                height: 38px;
            }
            .knob-indicator {
                height: 10px;
                transform-origin: center bottom;
            }
        }

        /* 
           VOICE NARRATION CONTROLS - 2050/1999 Blended Style
            */
        
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.3rem;
            padding: 0.4rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .voice-btn {
            /* 1999 Cartoon: Bold border, chunky button */
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(0, 212, 255, 0.05) 100%);
            border: 2px solid var(--cartoon-cyan);
            border-radius: 8px;
            padding: 0.5rem 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            /* 2050 Realistic: 3D shadows, holographic glow */
            box-shadow: 
                0 4px 0 rgba(0, 0, 0, 0.3),
                0 2px 8px rgba(0, 212, 255, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.1);
        }

        .voice-btn:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.4) 0%, rgba(0, 212, 255, 0.15) 100%);
            box-shadow: 
                0 6px 0 rgba(0, 0, 0, 0.3),
                0 4px 16px rgba(0, 212, 255, 0.5),
                inset 0 1px 2px rgba(255, 255, 255, 0.15);
        }

        .voice-btn.speaking {
            background: linear-gradient(135deg, rgba(255, 85, 0, 0.4) 0%, rgba(255, 85, 0, 0.1) 100%);
            border-color: var(--fire-orange);
            animation: voicePulse 1.5s ease-in-out infinite;
        }

        @keyframes voicePulse {
            0%, 100% { 
                box-shadow: 
                    0 4px 0 rgba(0, 0, 0, 0.3),
                    0 2px 8px rgba(255, 85, 0, 0.4),
                    0 0 20px rgba(255, 85, 0, 0.3),
                    inset 0 1px 2px rgba(255, 255, 255, 0.1);
            }
            50% { 
                box-shadow: 
                    0 4px 0 rgba(0, 0, 0, 0.3),
                    0 4px 16px rgba(255, 85, 0, 0.6),
                    0 0 40px rgba(255, 85, 0, 0.5),
                    inset 0 1px 2px rgba(255, 255, 255, 0.15);
            }
        }

        .voice-icon {
            width: 16px;
            height: 16px;
            fill: var(--cartoon-cyan);
            transition: fill 0.2s ease;
        }

        .voice-btn.speaking .voice-icon {
            fill: var(--fire-orange);
        }

        .voice-label {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            color: var(--parchment);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .voice-progress {
            flex: 1;
            height: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .voice-progress-bar {
            height: 100%;
            width: 0%;
            /* 1999 Cartoon: Bold gradient + 2050 Realistic: Smooth transition */
            background: linear-gradient(90deg, var(--cartoon-cyan), var(--fire-gold), var(--cartoon-purple));
            border-radius: 3px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .voice-status {
            font-family: 'Spectral', serif;
            font-size: 0.65rem;
            color: rgba(255,255,255,0.5);
            min-width: 60px;
            text-align: right;
        }

        .voice-status.speaking {
            color: var(--fire-gold);
            text-shadow: 0 0 8px rgba(255, 204, 0, 0.5);
        }

        .voice-params {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            justify-content: center;
            margin-top: 0.3rem;
            padding: 0.4rem;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .voice-param-control {
            flex: 0 0 200px;
            max-width: 300px;
        }

        .voice-param-label {
            font-family: 'Spectral', serif;
            font-size: 0.65rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 0.2rem;
            text-align: center;
        }

        .voice-param-value {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            color: var(--fire-gold);
            text-align: center;
            margin-top: 0.2rem;
        }

        /* Footer Attribution */
        .attribution {
            text-align: center;
            margin-top: 2rem;
            font-family: 'Spectral', serif;
            font-size: 0.75rem;
            color: rgba(26, 26, 26, 0.5);
            font-style: italic;
        }

        /* Mobile Touch Optimizations */
        @media (max-width: 768px) {
            /* Better touch handling */
            button,
            input[type="range"],
            .knob {
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
            }

            input[type="range"] {
                -webkit-appearance: none;
                width: 100%;
                height: 8px;
            }

            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 20px;
                height: 20px;
            }

            input[type="range"]::-moz-range-thumb {
                width: 20px;
                height: 20px;
            }
        }

        /* Responsive - Mobile Optimizations */
        @media (max-width: 768px) {
            /* Adjust base font size for mobile */
            html {
                font-size: 16px;
            }

            /* Player Section - Mobile */
            .player-section {
                padding: 0.75rem;
                border-bottom-width: 1px;
                width: 100%;
                max-width: 100vw;
                box-sizing: border-box;
            }

            .audio-player {
                min-width: 100% !important;
                max-width: 100% !important;
                width: 100% !important;
                padding: 1rem !important;
                border-width: 2px;
                border-radius: 12px;
                box-sizing: border-box;
            }

            /* Player Header - Mobile */
            .player-header {
                gap: 0.75rem;
                margin-bottom: 0.75rem;
            }

            .play-btn {
                width: 56px;
                height: 56px;
                flex-shrink: 0;
            }

            .play-btn svg {
                width: 20px;
                height: 20px;
            }

            .track-title {
                font-size: 0.9rem;
            }

            .track-artist {
                font-size: 0.75rem;
            }

            .quality-badge {
                font-size: 0.5rem !important;
                margin-top: 0.25rem !important;
            }

            /* Visualizer - Mobile */
            .visualizer-container {
                height: 60px;
                margin-bottom: 0.75rem;
            }

            /* Controls Row - Mobile */
            .controls-row {
                gap: 0.75rem;
                flex-wrap: wrap;
            }

            .volume-control,
            .tempo-control {
                flex: 1;
                min-width: 120px;
            }

            .volume-slider,
            .tempo-slider {
                width: 100%;
                height: 6px;
            }

            .volume-slider::-webkit-slider-thumb,
            .tempo-slider::-webkit-slider-thumb {
                width: 20px;
                height: 20px;
            }

            .volume-slider::-moz-range-thumb,
            .tempo-slider::-moz-range-thumb {
                width: 20px;
                height: 20px;
            }

            .tempo-label,
            .tempo-value {
                font-size: 0.7rem;
            }

            /* Voice Controls - Mobile */
            .voice-controls {
                gap: 0.75rem;
                margin-top: 0.75rem !important;
                padding-top: 0.75rem;
                flex-wrap: wrap;
            }

            .voice-btn {
                padding: 0.5rem 0.75rem;
                min-height: 44px; /* Touch target */
            }

            .voice-label {
                font-size: 0.6rem;
            }

            .voice-status {
                font-size: 0.65rem;
            }

            /* DJ Toolbox - Mobile */
            .dj-toolbox {
                grid-template-columns: 1fr !important;
                gap: 0.75rem;
                margin-top: 0.75rem;
                padding-top: 0.75rem;
            }

            .eq-section,
            .filter-section {
                margin-bottom: 0.5rem;
            }

            .section-title {
                font-size: 1rem !important; /* Increased from 0.75rem */
                margin-bottom: 1rem !important; /* Increased spacing */
            }

            .eq-controls,
            .filter-controls {
                gap: 0.75rem;
            }

            .eq-label,
            .filter-label {
                font-size: 0.7rem;
            }

            .eq-value,
            .filter-value {
                font-size: 0.7rem;
            }

            /* Recording Controls - Mobile */
            .recording-controls {
                gap: 0.75rem;
                margin-top: 0.75rem;
                padding-top: 0.75rem;
                flex-wrap: wrap;
            }

            .record-btn,
            .download-btn {
                min-width: 44px;
                min-height: 44px;
                padding: 0.5rem;
            }

            .record-label {
                font-size: 0.7rem;
            }

            .record-status,
            .record-time {
                font-size: 0.95rem !important; /* Increased from 0.7rem */
                font-weight: 500;
            }
            
            .record-info {
                gap: 0.5rem !important;
            }

            /* Social Sharing - Mobile */
            .social-sharing {
                gap: 0.5rem;
                margin-top: 0.75rem;
                padding-top: 0.75rem;
            }

            .social-btn {
                width: 48px !important; /* Increased from 40px */
                height: 48px !important;
                padding: 0.75rem !important;
            }

            .social-btn svg {
                width: 22px !important; /* Increased from 16px */
                height: 22px !important;
            }
            
            .social-sharing {
                gap: 0.75rem !important; /* Increased gap */
            }

            /* Container - Mobile layout */
            .container {
                flex-direction: column;
                min-height: auto;
            }

            /* App Content - Mobile layout */
            .app-content {
                flex-direction: column;
            }

            /* World Container - Mobile */
            .world-container {
                padding-top: 0;
            }

            /* Knobs Panels - Hide on mobile or make collapsible */
            .knobs-panel {
                display: none; /* Hide side panels on mobile */
            }
            
            /* Better text organization on mobile */
            .tagline {
                font-size: 1.5rem !important; /* Larger tagline */
                font-weight: 600;
            }
            
            .badge-text {
                font-size: 1.1rem !important;
            }
            
            .badge-sub {
                font-size: 0.9rem !important;
            }

            /* Horse SVG - Mobile */
            .horse-svg {
                width: 120px;
                height: 120px;
                bottom: 10px;
                right: 10px;
            }
        }

        @media (max-width: 480px) {
            /* Extra small screens - Maxi Design */
            html {
                font-size: 17px; /* Increased from 14px - still readable but larger */
            }

            .player-section {
                padding: 1rem; /* Increased from 0.5rem */
            }

            .audio-player {
                padding: 1.25rem !important; /* Increased from 0.75rem */
            }

            .play-btn {
                width: 64px !important; /* Increased from 48px */
                height: 64px !important;
            }

            .play-btn svg {
                width: 28px !important; /* Increased from 18px */
                height: 28px !important;
            }

            .track-title {
                font-size: 1.3rem !important; /* Increased from 0.85rem */
                font-weight: 700;
            }

            .track-artist {
                font-size: 1rem !important; /* Increased from 0.7rem */
            }

            .quality-badge {
                font-size: 0.55rem !important;
                margin-top: 0.25rem !important;
            }

            .visualizer-container {
                height: 60px; /* Increased from 50px */
                margin-bottom: 1rem !important;
            }

            .controls-row {
                flex-direction: column;
                gap: 1rem !important; /* Increased from 0.5rem */
                margin-top: 1.5rem !important;
                padding-top: 1.5rem !important;
            }

            .volume-control,
            .tempo-control {
                width: 100%;
                padding: 0.5rem 0 !important;
            }

            .dj-toolbox {
                gap: 1rem !important; /* Increased from 0.5rem */
                margin-top: 1.5rem !important;
                padding-top: 1.5rem !important;
            }

            .eq-controls,
            .filter-controls {
                gap: 1rem !important; /* Increased from 0.5rem */
                padding: 0.75rem 0 !important;
            }

            .horse-svg {
                width: 140px; /* Increased from 100px */
                height: 140px;
            }
            
            /* Larger voice controls for small screens */
            .voice-controls {
                padding: 1.25rem 0 !important;
            }
            
            .voice-btn {
                padding: 1.25rem 1.75rem !important;
                min-height: 64px !important;
            }
            
            .voice-label {
                font-size: 1.2rem !important;
            }
            
            /* Larger voice effects grid */
            .voice-effects-grid {
                gap: 1rem !important;
                grid-template-columns: repeat(2, 1fr) !important; /* 2 columns for better organization */
            }
            
            .voice-param-control {
                padding: 0.75rem !important;
            }
            
            /* Better organized bottom controls */
            .recording-social-row {
                flex-direction: column !important;
                gap: 1.25rem !important;
                align-items: stretch !important;
            }
            
            .recording-controls,
            .social-sharing {
                width: 100%;
                justify-content: center !important;
            }
        }

        /* Legacy responsive styles for hidden content */
        @media (max-width: 600px) {
            .main-card {
                padding: 1.5rem 1rem;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .scroll-paper {
                min-width: 90px;
                padding: 0.6rem 1rem;
            }

            .scroll-paper .date {
                font-size: 0.8rem;
            }

            .badge-inner {
                width: 80px;
                height: 80px;
            }

            .badge-text {
                font-size: 0.7rem;
            }
        }
    </style>
    <style>
        /* Track wrapper styles matching index */
        .track-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10000;
            background: 
                radial-gradient(ellipse at 20% 50%, rgba(255, 204, 0, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 50%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Space Mono', monospace;
        }

        .track-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
        }

        .track-nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .track-nav-title {
            font-size: 1rem;
            font-weight: 700;
            color: #ff5500;
            text-shadow: 0 0 10px rgba(255, 85, 0, 0.3);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .track-nav-title:hover {
            color: #ffcc00;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }

        .track-nav-back {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.4rem 0.8rem;
            border-radius: 2px;
        }

        .track-nav-back:hover {
            color: #ff5500;
            border-color: rgba(255, 85, 0, 0.3);
            background: rgba(255, 85, 0, 0.05);
        }

        .track-content-wrapper {
            margin-top: 70px; /* Space for fixed header */
        }

        @media (max-width: 768px) {
            .track-wrapper {
                padding: 0.8rem 1rem;
            }

            .track-nav-title {
                font-size: 0.85rem;
            }

            .track-nav-back {
                font-size: 0.65rem;
                padding: 0.3rem 0.6rem;
            }

            .track-content-wrapper {
                margin-top: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="track-wrapper">
        <nav class="track-nav">
            <a href="../" class="track-nav-title">Los Asbestos</a>
            <a href="../" class="track-nav-back"> Index</a>
        </nav>
    </div>
    <div class="track-content-wrapper">
    <div class="texture-overlay"></div>

    <!-- Thorny Border Frame -->
    <div class="border-frame">
        <div class="thorn-border thorn-top"></div>
        <div class="thorn-border thorn-bottom"></div>
        <div class="thorn-border thorn-left"></div>
        <div class="thorn-border thorn-right"></div>

        <!-- Corner Decorations -->
        <div class="corner corner-tl">
            <svg viewBox="0 0 100 100">
                <path d="M10,50 Q10,10 50,10 L50,20 Q20,20 20,50 Z"/>
                <circle cx="35" cy="35" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
        </div>
        <div class="corner corner-tr">
            <svg viewBox="0 0 100 100">
                <path d="M10,50 Q10,10 50,10 L50,20 Q20,20 20,50 Z"/>
                <circle cx="35" cy="35" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
        </div>
        <div class="corner corner-bl">
            <svg viewBox="0 0 100 100">
                <path d="M10,50 Q10,10 50,10 L50,20 Q20,20 20,50 Z"/>
                <circle cx="35" cy="35" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
        </div>
        <div class="corner corner-br">
            <svg viewBox="0 0 100 100">
                <path d="M10,50 Q10,10 50,10 L50,20 Q20,20 20,50 Z"/>
                <circle cx="35" cy="35" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
        </div>
    </div>

    <div class="container">
        <!-- App Content Area - Controls and World View -->
        <div class="app-content">
        <!-- Player Section -->
        <div class="player-section">
            <div class="audio-player" style="min-width: 400px; max-width: 800px; width: 100%;">
            <div class="player-header">
                <button class="play-btn" id="playBtn">
                    <svg class="play-icon" viewBox="0 0 24 24">
                        <polygon points="5,3 19,12 5,21"/>
                    </svg>
                    <svg class="pause-icon" viewBox="0 0 24 24">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                </button>
                <div class="track-info">
                    <div class="track-title">Hinoeuma</div>
                    <div class="track-artist">Los Asbestos</div>
                    <div class="quality-badge">320kHz  32-bit float  Lossless</div>
                </div>
                <div class="status-dot" id="statusDot"></div>
            </div>
            
            <div class="visualizer-container">
                <div class="visualizer" id="visualizer"></div>
            </div>

            <!-- Voice Controls -->
            <div class="voice-controls">
                <button class="voice-btn" id="voiceBtn" title="Start/Stop Narration">
                    <svg class="voice-icon" viewBox="0 0 24 24">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                    <span class="voice-label">SPEAK</span>
                </button>
                <div class="voice-progress">
                    <div class="voice-progress-bar" id="voiceProgressBar"></div>
                </div>
                <span class="voice-status" id="voiceStatus">Ready</span>
            </div>

            <!-- Voice Parameter Controls -->
            <div class="voice-params">
                <div class="voice-param-control">
                    <div class="voice-param-label">Voice Volume</div>
                    <input type="range" class="slider voice-slider" id="voiceVolume" min="0" max="100" value="80">
                    <div class="voice-param-value" id="voiceVolumeValue">80</div>
                </div>
            </div>
            
            <!-- Voice Effects Controls -->
            <div class="voice-effects" style="margin-top: 0.3rem; padding: 0.5rem; background: rgba(0, 0, 0, 0.25); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 6px; box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);">
                <div class="voice-effects-title" style="font-family: 'Spectral', serif; font-size: 0.65rem; color: rgba(255,255,255,0.7); margin-bottom: 0.4rem; text-align: center;">Voice Effects</div>
                <div class="voice-effects-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.5rem;">
                    <!-- Voice EQ Low -->
                    <div class="voice-param-control">
                        <div class="voice-param-label">EQ Low</div>
                        <input type="range" class="slider voice-slider" id="voiceEQLow" min="-12" max="12" value="2" step="0.5">
                        <div class="voice-param-value" id="voiceEQLowValue">+2.0</div>
                    </div>
                    <!-- Voice EQ Mid -->
                    <div class="voice-param-control">
                        <div class="voice-param-label">EQ Mid</div>
                        <input type="range" class="slider voice-slider" id="voiceEQMid" min="-12" max="12" value="0.5" step="0.5">
                        <div class="voice-param-value" id="voiceEQMidValue">+0.5</div>
                    </div>
                    <!-- Voice EQ High -->
                    <div class="voice-param-control">
                        <div class="voice-param-label">EQ High</div>
                        <input type="range" class="slider voice-slider" id="voiceEQHigh" min="-12" max="12" value="1.5" step="0.5">
                        <div class="voice-param-value" id="voiceEQHighValue">+1.5</div>
                    </div>
                    <!-- Voice Filter -->
                    <div class="voice-param-control">
                        <div class="voice-param-label">Filter</div>
                        <input type="range" class="slider voice-slider" id="voiceFilter" min="2000" max="20000" value="12000" step="100">
                        <div class="voice-param-value" id="voiceFilterValue">12k</div>
                    </div>
                    <!-- Voice Reverb -->
                    <div class="voice-param-control">
                        <div class="voice-param-label">Reverb</div>
                        <input type="range" class="slider voice-slider" id="voiceReverb" min="0" max="100" value="30" step="1">
                        <div class="voice-param-value" id="voiceReverbValue">30</div>
                    </div>
                    <!-- Voice Distortion -->
                    <div class="voice-param-control">
                        <div class="voice-param-label">Distortion</div>
                        <input type="range" class="slider voice-slider" id="voiceDistortion" min="0" max="50" value="15" step="1">
                        <div class="voice-param-value" id="voiceDistortionValue">15</div>
                    </div>
                </div>
            </div>
            
            <!-- Track Mixer - Multiple Audio Tracks with Fade Controls -->
            <div class="track-mixer" style="margin-top: 0.3rem; padding: 0.5rem; background: rgba(0, 0, 0, 0.25); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 6px; box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);">
                <div class="track-mixer-title">Track Mixer</div>
                <div class="track-groups">
                    <!-- Voice Track Group -->
                    <div class="track-group" data-group="voice">
                        <div class="track-group-header">
                            <label class="track-group-toggle">
                                <input type="checkbox" id="trackVoiceToggle" checked>
                                <span class="track-group-name">Voice</span>
                            </label>
                            <div class="track-group-volume">
                                <input type="range" class="track-volume-slider" id="trackVoiceVolume" min="0" max="100" value="80">
                                <span class="track-volume-value" id="trackVoiceVolumeValue">80</span>
                            </div>
                        </div>
                    </div>

                    <!-- Deep Jungle Sounds Track Group -->
                    <div class="track-group" data-group="jungle">
                        <div class="track-group-header">
                            <label class="track-group-toggle">
                                <input type="checkbox" id="trackJungleToggle" checked>
                                <span class="track-group-name">Deep Jungle</span>
                            </label>
                            <div class="track-group-volume">
                                <input type="range" class="track-volume-slider" id="trackJungleVolume" min="0" max="100" value="60">
                                <span class="track-volume-value" id="trackJungleVolumeValue">60</span>
                            </div>
                        </div>
                        <div class="track-list" id="jungleTrackList">
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackJungleAmbient" checked>
                                    <span class="track-item-name">Ambient</span>
                                </label>
                            </div>
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackJungleBirds">
                                    <span class="track-item-name">Birds</span>
                                </label>
                            </div>
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackJungleRain">
                                    <span class="track-item-name">Rain</span>
                                </label>
                            </div>
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackJungleInsects">
                                    <span class="track-item-name">Insects</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Groovy Tracks Group -->
                    <div class="track-group" data-group="groovy">
                        <div class="track-group-header">
                            <label class="track-group-toggle">
                                <input type="checkbox" id="trackGroovyToggle">
                                <span class="track-group-name">Groovy</span>
                            </label>
                            <div class="track-group-volume">
                                <input type="range" class="track-volume-slider" id="trackGroovyVolume" min="0" max="100" value="70">
                                <span class="track-volume-value" id="trackGroovyVolumeValue">70</span>
                            </div>
                        </div>
                        <div class="track-list" id="groovyTrackList">
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackGroovyBass">
                                    <span class="track-item-name">Bass</span>
                                </label>
                            </div>
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackGroovyRhythm">
                                    <span class="track-item-name">Rhythm</span>
                                </label>
                            </div>
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackGroovyLead">
                                    <span class="track-item-name">Lead</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- MusicGen Generated Music Group -->
                    <div class="track-group" data-group="musicgen">
                        <div class="track-group-header">
                            <label class="track-group-toggle">
                                <input type="checkbox" id="trackMusicGenToggle">
                                <span class="track-group-name">MusicGen</span>
                            </label>
                            <div class="track-group-volume">
                                <input type="range" class="track-volume-slider" id="trackMusicGenVolume" min="0" max="100" value="75">
                                <span class="track-volume-value" id="trackMusicGenVolumeValue">75</span>
                            </div>
                        </div>
                        <div class="track-list" id="musicGenTrackList">
                            <div class="track-item">
                                <label class="track-item-toggle">
                                    <input type="checkbox" id="trackMusicGenMain" checked>
                                    <span class="track-item-name">Generated Music</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Professional DJ Toolbox: EQ & Filters -->
            <div class="dj-toolbox">
                <!-- 3-Band EQ -->
                <div class="eq-section">
                    <div class="section-title">EQ</div>
                    <div class="eq-controls">
                        <div class="eq-band">
                            <div class="eq-label">Low</div>
                            <div class="eq-slider-container">
                                <input type="range" class="eq-slider" id="eqLow" min="-12" max="12" value="0" orient="vertical">
                                <div class="eq-value" id="eqLowValue">0</div>
                            </div>
                        </div>
                        <div class="eq-band">
                            <div class="eq-label">Mid</div>
                            <div class="eq-slider-container">
                                <input type="range" class="eq-slider" id="eqMid" min="-12" max="12" value="0" orient="vertical">
                                <div class="eq-value" id="eqMidValue">0</div>
                            </div>
                        </div>
                        <div class="eq-band">
                            <div class="eq-label">High</div>
                            <div class="eq-slider-container">
                                <input type="range" class="eq-slider" id="eqHigh" min="-12" max="12" value="0" orient="vertical">
                                <div class="eq-value" id="eqHighValue">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="section-title">Filter</div>
                    <div class="filter-controls">
                        <div class="filter-control">
                            <div class="filter-label">Cutoff</div>
                            <div class="filter-slider-container">
                                <input type="range" class="filter-slider" id="filterCutoff" min="0" max="100" value="25" orient="vertical">
                                <div class="filter-value" id="filterCutoffValue">25</div>
                            </div>
                            <div class="filter-toggle">
                                <button class="filter-btn" data-filter="hp">HP</button>
                                <button class="filter-btn active" data-filter="lp">LP</button>
                                <button class="filter-btn" data-filter="bp">BP</button>
                            </div>
                        </div>
                        <div class="filter-control">
                            <div class="filter-label">Res</div>
                            <div class="filter-slider-container">
                                <input type="range" class="filter-slider" id="filterRes" min="0" max="100" value="0" orient="vertical">
                                <div class="filter-value" id="filterResValue">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Controls: Drums & Bass Knobs -->
            <div class="controls-knobs-section">
                <div class="knobs-section-title">Controls</div>
                
                <!-- DRUMS -->
                <div class="knob-group">
                    <div class="knob-group-title">Drums</div>
                    <div class="knob-row">
                        <div class="knob-container">
                            <div class="knob" data-param="kickPunch" data-min="0" data-max="100" data-value="70">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Kick Punch</div>
                            <div class="knob-value">70</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="kickDecay" data-min="0" data-max="100" data-value="50">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Kick Decay</div>
                            <div class="knob-value">50</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="clapSnap" data-min="0" data-max="100" data-value="60">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Clap Snap</div>
                            <div class="knob-value">60</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="hatBright" data-min="0" data-max="100" data-value="65">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Hat Bright</div>
                            <div class="knob-value">65</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="hatDecay" data-min="0" data-max="100" data-value="40">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Hat Decay</div>
                            <div class="knob-value">40</div>
                        </div>
                    </div>
                </div>

                <!-- BASS -->
                <div class="knob-group">
                    <div class="knob-group-title">Bass</div>
                    <div class="knob-row">
                        <div class="knob-container">
                            <div class="knob" data-param="bassFilter" data-min="0" data-max="100" data-value="45">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Filter</div>
                            <div class="knob-value">45</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="bassReso" data-min="0" data-max="100" data-value="55">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Resonance</div>
                            <div class="knob-value">55</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="bassDrive" data-min="0" data-max="100" data-value="60">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Drive</div>
                            <div class="knob-value">60</div>
                        </div>
                        <div class="knob-container">
                            <div class="knob" data-param="subLevel" data-min="0" data-max="100" data-value="70">
                                <div class="knob-ring"></div>
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="knob-label">Sub Level</div>
                            <div class="knob-value">70</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Controls Row: Volume, Tempo, Recording, Social -->
            <div class="bottom-controls-row">
                <!-- Sound Controls -->
                <div class="controls-row">
                    <div class="volume-control">
                        <svg class="volume-icon" viewBox="0 0 24 24">
                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                        </svg>
                        <input type="range" class="slider volume-slider" id="volumeSlider" min="0" max="100" value="60">
                    </div>
                    <div class="tempo-control">
                        <span class="tempo-label">BPM</span>
                        <input type="range" class="slider tempo-slider" id="tempoSlider" min="80" max="145" value="85">
                        <span class="tempo-value" id="tempoValue">85</span>
                    </div>
                </div>
                
                <!-- Export/Download Controls -->
                <div class="export-controls">
                    <button class="record-btn" id="recordBtn" title="Record lossless WAV">
                        <svg class="record-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="8"/>
                        </svg>
                        <span class="record-label">REC</span>
                    </button>
                    <div class="record-info">
                        <span class="record-status" id="recordStatus">Ready</span>
                        <span class="record-time" id="recordTime">00:00</span>
                    </div>
                    <button class="download-btn" id="downloadBtn" disabled title="Download WAV (320kHz/32-bit float)">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        <span>WAV</span>
                    </button>
                </div>
                
                <!-- Social Sharing -->
                <div class="social-sharing">
                        <a href="#" class="social-btn twitter" id="twitterShare" title="Share on X (Twitter)" target="_blank">
                            <svg viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="#" class="social-btn facebook" id="facebookShare" title="Share on Facebook" target="_blank">
                            <svg viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        <a href="#" class="social-btn reddit" id="redditShare" title="Share on Reddit" target="_blank">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <button class="social-btn copy" id="copyLinkBtn" title="Copy link">
                            <svg viewBox="0 0 24 24">
                                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Fire Horse SVG (Dragon) - Floating Bottom Right -->
        <svg class="horse-svg" viewBox="0 0 200 200" id="horseSvg">
                    <defs>
                        <linearGradient id="fireGradient" x1="0%" y1="100%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#c23a22"/>
                            <stop offset="50%" style="stop-color:#e85a1b"/>
                            <stop offset="100%" style="stop-color:#f4a636"/>
                        </linearGradient>
                        <linearGradient id="flameGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" style="stop-color:#e85a1b"/>
                            <stop offset="100%" style="stop-color:#f4a636"/>
                        </linearGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Horse Body -->
                    <g filter="url(#glow)" id="horseGroup">
                        <!-- Rearing Horse Shape -->
                        <path id="horseBody" fill="url(#fireGradient)" d="
                            M100,180 
                            Q85,170 80,150 
                            L75,130 
                            Q70,115 75,100
                            L80,85
                            Q85,70 95,60
                            L100,50
                            Q110,40 115,45
                            L125,55
                            Q135,50 140,55
                            L145,65
                            Q150,75 145,85
                            L140,95
                            Q145,105 145,115
                            L150,130
                            Q155,145 150,160
                            L145,175
                            Q140,185 130,185
                            L120,180
                            Q110,185 100,180
                            Z
                        "/>
                        
                        <!-- Front Legs -->
                        <path id="frontLeg1" class="horse-leg" fill="url(#fireGradient)" d="
                            M85,115 L75,145 Q70,155 75,160 L80,155 L90,125 Z
                        "/>
                        <path id="frontLeg2" class="horse-leg" fill="url(#fireGradient)" d="
                            M95,120 L90,150 Q88,158 92,162 L97,157 L102,127 Z
                        "/>
                        
                        <!-- Back Legs -->
                        <path id="backLeg1" class="horse-leg" fill="url(#fireGradient)" d="
                            M125,150 L130,175 Q132,182 128,185 L122,180 L118,155 Z
                        "/>
                        <path id="backLeg2" class="horse-leg" fill="url(#fireGradient)" d="
                            M140,145 L148,170 Q152,178 147,182 L140,175 L135,150 Z
                        "/>
                        
                        <!-- Head -->
                        <path id="horseHead" fill="url(#fireGradient)" d="
                            M95,60 
                            Q85,55 80,45
                            L75,35
                            Q75,25 85,25
                            L95,28
                            Q100,30 105,28
                            L110,25
                            Q115,22 118,28
                            L115,40
                            Q118,50 115,55
                            L105,58
                            Q100,60 95,60
                            Z
                        "/>
                        
                        <!-- Ear -->
                        <path id="horseEar" fill="url(#flameGradient)" d="
                            M90,28 L85,15 Q88,12 93,18 L95,28 Z
                        "/>
                        
                        <!-- Eye -->
                        <circle id="horseEye" cx="92" cy="38" r="3" fill="#1a1a1a"/>
                        
                        <!-- Mane Flames -->
                        <path fill="url(#flameGradient)" d="
                            M105,30 Q120,20 115,5 Q125,15 120,30 Q130,15 125,0 Q140,20 130,40 L115,45 Z
                        " class="flame-mane"/>
                        
                        <path fill="url(#flameGradient)" d="
                            M115,50 Q135,45 130,25 Q145,40 135,55 L120,58 Z
                        " class="flame-mane"/>
                        
                        <path fill="url(#flameGradient)" d="
                            M120,65 Q145,55 140,35 Q155,55 140,75 L125,72 Z
                        " class="flame-mane"/>
                        
                        <!-- Tail Flames -->
                        <path fill="url(#flameGradient)" d="
                            M150,160 Q175,150 170,125 Q185,145 170,170 Q160,180 150,175 Z
                        " class="flame-tail"/>
                        
                        <path fill="url(#flameGradient)" d="
                            M155,145 Q180,130 175,105 Q195,130 175,160 L155,155 Z
                        " class="flame-tail"/>
                    </g>
                </svg>

        <!-- World Container - Center -->
        <div class="world-container" id="worldContainer">
        </div>
        </div>
    </div>

        <!-- Hidden: Keep old structure for reference but remove visually -->
        <div style="display: none;">
        <div class="main-card">
            <!-- Header -->
            <div class="header">
                <h1>The upcoming Year of the Horse</h1>
            </div>

            <!-- Scroll Dates -->
            <div class="scroll-dates">
                <div class="scroll-handle"></div>
                <div class="scroll-paper">
                    <span class="label">Begins:</span>
                    <span class="date">February 17, 2026</span>
                </div>
                <div class="scroll-paper">
                    <span class="label">Ends:</span>
                    <span class="date">February 5, 2027</span>
                </div>
                <div class="scroll-handle"></div>
            </div>

            <!-- Horse Illustration -->
            <div class="horse-container">
                <div class="stars" id="stars"></div>
                <div class="fire-particles" id="fireParticles"></div>
                
                <!-- Stylized Fire Horse SVG -->
                <svg class="horse-svg" viewBox="0 0 200 200">
                    <defs>
                        <linearGradient id="fireGradient" x1="0%" y1="100%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#c23a22"/>
                            <stop offset="50%" style="stop-color:#e85a1b"/>
                            <stop offset="100%" style="stop-color:#f4a636"/>
                        </linearGradient>
                        <linearGradient id="flameGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" style="stop-color:#e85a1b"/>
                            <stop offset="100%" style="stop-color:#f4a636"/>
                        </linearGradient>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Horse Body -->
                    <g filter="url(#glow)">
                        <!-- Rearing Horse Shape -->
                        <path fill="url(#fireGradient)" d="
                            M100,180 
                            Q85,170 80,150 
                            L75,130 
                            Q70,115 75,100
                            L80,85
                            Q85,70 95,60
                            L100,50
                            Q110,40 115,45
                            L125,55
                            Q135,50 140,55
                            L145,65
                            Q150,75 145,85
                            L140,95
                            Q145,105 145,115
                            L150,130
                            Q155,145 150,160
                            L145,175
                            Q140,185 130,185
                            L120,180
                            Q110,185 100,180
                            Z
                        "/>
                        
                        <!-- Front Legs -->
                        <path fill="url(#fireGradient)" d="
                            M85,115 L75,145 Q70,155 75,160 L80,155 L90,125 Z
                        "/>
                        <path fill="url(#fireGradient)" d="
                            M95,120 L90,150 Q88,158 92,162 L97,157 L102,127 Z
                        "/>
                        
                        <!-- Back Legs -->
                        <path fill="url(#fireGradient)" d="
                            M125,150 L130,175 Q132,182 128,185 L122,180 L118,155 Z
                        "/>
                        <path fill="url(#fireGradient)" d="
                            M140,145 L148,170 Q152,178 147,182 L140,175 L135,150 Z
                        "/>
                        
                        <!-- Head -->
                        <path fill="url(#fireGradient)" d="
                            M95,60 
                            Q85,55 80,45
                            L75,35
                            Q75,25 85,25
                            L95,28
                            Q100,30 105,28
                            L110,25
                            Q115,22 118,28
                            L115,40
                            Q118,50 115,55
                            L105,58
                            Q100,60 95,60
                            Z
                        "/>
                        
                        <!-- Ear -->
                        <path fill="url(#flameGradient)" d="
                            M90,28 L85,15 Q88,12 93,18 L95,28 Z
                        "/>
                        
                        <!-- Eye -->
                        <circle cx="92" cy="38" r="3" fill="#1a1a1a"/>
                        
                        <!-- Mane Flames -->
                        <path fill="url(#flameGradient)" d="
                            M105,30 Q120,20 115,5 Q125,15 120,30 Q130,15 125,0 Q140,20 130,40 L115,45 Z
                        " class="flame-mane"/>
                        
                        <path fill="url(#flameGradient)" d="
                            M115,50 Q135,45 130,25 Q145,40 135,55 L120,58 Z
                        " class="flame-mane"/>
                        
                        <path fill="url(#flameGradient)" d="
                            M120,65 Q145,55 140,35 Q155,55 140,75 L125,72 Z
                        " class="flame-mane"/>
                        
                        <!-- Tail Flames -->
                        <path fill="url(#flameGradient)" d="
                            M150,160 Q175,150 170,125 Q185,145 170,170 Q160,180 150,175 Z
                        " class="flame-tail"/>
                        
                        <path fill="url(#flameGradient)" d="
                            M155,145 Q180,130 175,105 Q195,130 175,160 L155,155 Z
                        " class="flame-tail"/>
                    </g>
                </svg>

                <!-- Badge -->
                <div class="badge">
                    <div class="badge-inner">
                        <span class="badge-text">FIRE<br>HORSE<br>YEAR</span>
                        <span class="badge-sub">ONCE EVERY 60 YEARS</span>
                    </div>
                </div>
            </div>

            <!-- Wave Decorations -->
            <div class="wave-decoration">
                <div class="wave-circle"></div>
                <div class="wave-circle"></div>
            </div>

            <!-- Tagline -->
            <div class="tagline">Momentum with Purpose</div>

        <div class="attribution">
            A rare combination  once every 60 years
        </div>
    </div>

    <script>
        // 
        // DARK TECHNO / INDUSTRIAL GENERATIVE SYNTHESIZER
        // With grunge effects, distortion, bitcrushing, and jungle ambience
        // 

        // Generate Stars
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 2 + 's';
            star.style.animationDuration = (1.5 + Math.random()) + 's';
            starsContainer.appendChild(star);
        }

        // Generate Fire Particles
        const fireContainer = document.getElementById('fireParticles');
        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = (30 + Math.random() * 40) + '%';
            particle.style.bottom = (20 + Math.random() * 30) + '%';
            particle.style.animationDuration = (1.5 + Math.random()) + 's';
            particle.style.background = `hsl(${20 + Math.random() * 30}, 100%, ${50 + Math.random() * 20}%)`;
            fireContainer.appendChild(particle);
            setTimeout(() => particle.remove(), 2000);
        }
        setInterval(createParticle, 150);

        // Flame animation
        const flameElements = document.querySelectorAll('.flame-mane, .flame-tail');
        flameElements.forEach((el, i) => {
            el.style.animation = `flameFlicker ${1 + Math.random() * 0.5}s ease-in-out infinite`;
            el.style.animationDelay = `${i * 0.1}s`;
        });
        const flameStyle = document.createElement('style');
        flameStyle.textContent = `
            @keyframes flameFlicker {
                0%, 100% { transform: scale(1) translateX(0); opacity: 0.9; }
                25% { transform: scale(1.05) translateX(2px); opacity: 1; }
                50% { transform: scale(0.98) translateX(-1px); opacity: 0.85; }
                75% { transform: scale(1.02) translateX(1px); opacity: 0.95; }
            }
        `;
        document.head.appendChild(flameStyle);

        // 
        // DARK TECHNO WEB AUDIO ENGINE
        // 

        let audioCtx = null;
        let masterGain = null;
        let compressor = null;
        let analyser = null;
        let isPlaying = false;
        // Professional DJ Toolbox nodes
        let eqLow = null;
        let eqMid = null;
        let eqHigh = null;
        let djFilter = null;
        let filterType = 'lowpass'; // 'lowpass', 'highpass', 'bandpass'
        let bpm = 85;
        let schedulerInterval = null;
        let nextNoteTime = 0;
        let currentStep = 0;

        // 
        // SYNTH PARAMETERS - Controlled by 22 knobs
        // 
        const synthParams = {
            // Drums
            kickPunch: 180,      // Start frequency
            kickDecay: 0.5,      // Decay time
            clapSnap: 1500,      // Clap filter frequency
            hatBright: 8000,     // Hi-hat highpass
            hatDecay: 0.06,      // Hat decay time
            // Bass
            bassFilter: 800,     // Filter cutoff
            bassReso: 8,         // Filter Q
            bassDrive: 15,       // Distortion amount
            subLevel: 0.7,       // Sub bass level
            // Synths
            padCutoff: 400,      // Pad filter cutoff
            padDetune: 12,       // Detune amount in cents
            stabAttack: 0.01,    // Stab attack time
            stabFilter: 2000,    // Stab filter frequency
            // Effects
            reverbDark: 1200,    // Reverb darkness (filter)
            // Jungle
            rainLevel: 0.5,
            birdsLevel: 0.45,
            insectsLevel: 0.4,
            thunderLevel: 0.3
        };

        // Dark scales (D Phrygian - darker, more tension)
        const ROOT = 73.42; // D2 - lower root for darker sound
        const SCALE = [0, 1, 3, 5, 7, 8, 10]; // Phrygian mode
        const CHORD_PROG = [
            [0, 3, 7],      // Dm
            [1, 5, 8],      // Eb (bII - tension)
            [-2, 1, 5],     // C
            [0, 3, 6],      // Dim
        ];

        function noteToFreq(degree, octaveShift = 0) {
            const octave = Math.floor(degree / 7);
            const note = SCALE[((degree % 7) + 7) % 7];
            const semitones = octave * 12 + note;
            return ROOT * Math.pow(2, (semitones / 12) + octaveShift);
        }

        // 
        // GRUNGE EFFECTS PROCESSORS
        // 

        let distortionNode = null;
        let bitcrusherNode = null;
        let reverbGain = null;
        let jungleGain = null;

        // Create distortion curve for warm overdrive
        function makeDistortionCurve(amount) {
            const samples = 44100;
            const curve = new Float32Array(samples);
            const deg = Math.PI / 180;
            
            for (let i = 0; i < samples; i++) {
                const x = (i * 2) / samples - 1;
                curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));
            }
            return curve;
        }

        // Bitcrusher using AudioWorklet simulation with ScriptProcessor fallback
        function createBitcrusher() {
            const bufferSize = 4096;
            const crusher = audioCtx.createScriptProcessor(bufferSize, 1, 1);
            let phaser = 0;
            const bits = 6; // Low bit depth for gritty sound
            const normFreq = 0.1; // Sample rate reduction
            let lastSample = 0;
            
            crusher.onaudioprocess = (e) => {
                const input = e.inputBuffer.getChannelData(0);
                const output = e.outputBuffer.getChannelData(0);
                const step = Math.pow(0.5, bits);
                
                for (let i = 0; i < bufferSize; i++) {
                    phaser += normFreq;
                    if (phaser >= 1) {
                        phaser -= 1;
                        lastSample = step * Math.floor(input[i] / step + 0.5);
                    }
                    output[i] = lastSample;
                }
            };
            return crusher;
        }

        // Initialize Audio Context with effect chain
        function initAudio() {
            if (audioCtx) return;
            
            // Create audio context at 320kHz for professional lossless quality
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext({ sampleRate: 320000 });
            
            // Master gain
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.5;
            
            // Professional DJ Toolbox: 3-Band EQ
            eqLow = audioCtx.createBiquadFilter();
            eqLow.type = 'lowshelf';
            eqLow.frequency.value = 200;
            eqLow.gain.value = 0;
            
            eqMid = audioCtx.createBiquadFilter();
            eqMid.type = 'peaking';
            eqMid.frequency.value = 1000;
            eqMid.Q.value = 1;
            eqMid.gain.value = 0;
            
            eqHigh = audioCtx.createBiquadFilter();
            eqHigh.type = 'highshelf';
            eqHigh.frequency.value = 4000;
            eqHigh.gain.value = 0;
            
            // Professional DJ Filter (HP/LP/BP) - Default to low cutoff (25% = ~700Hz)
            djFilter = audioCtx.createBiquadFilter();
            djFilter.type = 'lowpass';
            // Map 25 to frequency: 20 * Math.pow(20000 / 20, 25 / 100)  700Hz
            djFilter.frequency.value = 20 * Math.pow(20000 / 20, 0.25);
            djFilter.Q.value = 1;
            
            // Distortion
            distortionNode = audioCtx.createWaveShaper();
            distortionNode.curve = makeDistortionCurve(20);
            distortionNode.oversample = '4x';
            
            // Pre-distortion filter (warm it up)
            const preFilter = audioCtx.createBiquadFilter();
            preFilter.type = 'lowpass';
            preFilter.frequency.value = 3000;
            
            // Post-distortion filter (tame harshness)
            const postFilter = audioCtx.createBiquadFilter();
            postFilter.type = 'lowpass';
            postFilter.frequency.value = 8000;
            
            // Compressor
            compressor = audioCtx.createDynamicsCompressor();
            compressor.threshold.value = -24;
            compressor.knee.value = 6;
            compressor.ratio.value = 8;
            compressor.attack.value = 0.003;
            compressor.release.value = 0.15;
            
            // Analyser
            analyser = audioCtx.createAnalyser();
            analyser.fftSize = 64;
            
            // Reverb send
            reverbGain = audioCtx.createGain();
            reverbGain.gain.value = 0.25;
            
            // Jungle ambience bus (will be used by track mixer)
            jungleGain = audioCtx.createGain();
            jungleGain.gain.value = 0.6; // Default to 60% (matches track mixer default)
            
            // Main chain: masterGain -> EQ -> preFilter -> distortion -> postFilter -> DJ Filter -> compressor -> analyser -> output
            masterGain.connect(eqLow);
            eqLow.connect(eqMid);
            eqMid.connect(eqHigh);
            eqHigh.connect(preFilter);
            preFilter.connect(distortionNode);
            distortionNode.connect(postFilter);
            postFilter.connect(djFilter);
            djFilter.connect(compressor);
            compressor.connect(analyser);
            analyser.connect(audioCtx.destination);
            
            // Reverb chain
            createDarkReverb();
            
            // Jungle direct to output (cleaner)
            jungleGain.connect(audioCtx.destination);
            
            // 
            // VOICE EFFECTS CHAIN - 320kHz Lossless
            // 
            
            // Voice gain (volume control)
            voiceGain = audioCtx.createGain();
            voiceGain.gain.value = 0.8; // Default 80%
            
            // Voice EQ - 3-band
            voiceEQ = {
                low: audioCtx.createBiquadFilter(),
                mid: audioCtx.createBiquadFilter(),
                high: audioCtx.createBiquadFilter()
            };
            voiceEQ.low.type = 'lowshelf';
            voiceEQ.low.frequency.value = 250;
            voiceEQ.low.gain.value = 2.0; // Default: boost lows
            voiceEQ.mid.type = 'peaking';
            voiceEQ.mid.frequency.value = 1000;
            voiceEQ.mid.Q.value = 1.5;
            voiceEQ.mid.gain.value = 0.5; // Default: slight mid boost
            voiceEQ.high.type = 'highshelf';
            voiceEQ.high.frequency.value = 4000;
            voiceEQ.high.gain.value = 1.5; // Default: boost highs
            
            // Voice filter (lowpass to remove harshness)
            voiceFilter = audioCtx.createBiquadFilter();
            voiceFilter.type = 'lowpass';
            voiceFilter.frequency.value = 12000;
            voiceFilter.Q.value = 1;
            
            // Voice distortion (subtle warmth)
            voiceDistortion = audioCtx.createWaveShaper();
            voiceDistortion.curve = makeDistortionCurve(15); // Gentler than main distortion
            voiceDistortion.oversample = '4x';
            
            // Voice reverb (dark, spacious)
            voiceReverb = audioCtx.createGain();
            voiceReverb.gain.value = 0.3;
            createVoiceReverb();
            
            // Stereo width/expansion (to expand the sound)
            // Use channel splitter/merger for stereo widening
            voiceChannelSplitter = audioCtx.createChannelSplitter(2);
            voiceChannelMerger = audioCtx.createChannelMerger(2);
            voiceStereoWidth = audioCtx.createGain();
            voiceStereoWidth.gain.value = 1.0;
            
            // Voice effects chain: gain -> EQ -> filter -> distortion -> stereo width -> reverb -> destination
            // (Chain will be connected when voice is playing)
            
            // Initialize track mixer gains
            trackGroupGains.voice = voiceGain; // Use existing voiceGain
            trackGroupGains.jungle = jungleGain; // Use existing jungleGain
            trackGroupGains.groovy = audioCtx.createGain();
            trackGroupGains.groovy.gain.value = 0.7;
            trackGroupGains.groovy.connect(audioCtx.destination);
            trackGroupGains.musicgen = audioCtx.createGain();
            trackGroupGains.musicgen.gain.value = 0.75;
            trackGroupGains.musicgen.connect(audioCtx.destination);
            
            // Initialize track mixer (replaces old jungle ambience system)
            initTrackMixer();
        }
        
        function createVoiceReverb() {
            // Create dark reverb for voice with multiple delay taps
            const delays = [0.08, 0.15, 0.23, 0.31];
            delays.forEach((time, i) => {
                const delay = audioCtx.createDelay();
                delay.delayTime.value = time;
                
                const feedback = audioCtx.createGain();
                feedback.gain.value = 0.25 - (i * 0.05);
                
                const filter = audioCtx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 2500 - (i * 200); // Progressively darker
                
                voiceReverb.connect(delay);
                delay.connect(filter);
                filter.connect(feedback);
                feedback.connect(delay);
                filter.connect(audioCtx.destination);
            });
        }
        
        function applyStereoWidth(source) {
            // Expand stereo width using cross-feeding and delay
            // Split channels, add cross-feed, and merge for wider stereo image
            const splitter = audioCtx.createChannelSplitter(2);
            const merger = audioCtx.createChannelMerger(2);
            
            // Direct connections (original signal)
            source.connect(splitter);
            
            // Direct paths (keep original)
            const directGainL = audioCtx.createGain();
            const directGainR = audioCtx.createGain();
            directGainL.gain.value = 0.7; // 70% original
            directGainR.gain.value = 0.7;
            splitter.connect(directGainL, 0); // Left direct
            splitter.connect(directGainR, 1); // Right direct
            directGainL.connect(merger, 0, 0); // Left to left
            directGainR.connect(merger, 0, 1); // Right to right
            
            // Cross-feed paths (expand width)
            const crossGainL = audioCtx.createGain();
            const crossGainR = audioCtx.createGain();
            crossGainL.gain.value = -0.25; // Cross-feed left to right (inverted)
            crossGainR.gain.value = -0.25; // Cross-feed right to left (inverted)
            splitter.connect(crossGainL, 0); // Left to right cross
            splitter.connect(crossGainR, 1); // Right to left cross
            crossGainL.connect(merger, 0, 1); // Left cross to right
            crossGainR.connect(merger, 0, 0); // Right cross to left
            
            return merger;
        }

        function createDarkReverb() {
            // Longer, darker reverb for cavernous feel
            const delays = [0.05, 0.09, 0.13, 0.19, 0.27, 0.37, 0.47];
            delays.forEach((time, i) => {
                const delay = audioCtx.createDelay();
                delay.delayTime.value = time;
                
                const feedback = audioCtx.createGain();
                feedback.gain.value = 0.3 - (i * 0.03);
                
                const filter = audioCtx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 1200 - (i * 100); // Progressively darker
                
                reverbGain.connect(delay);
                delay.connect(filter);
                filter.connect(feedback);
                feedback.connect(delay);
                filter.connect(masterGain);
            });
        }

        // 
        // JUNGLE AMBIENCE - WAV FILE PLAYBACK
        // Deep jungle sounds loaded from WAV files
        // 

        let jungleAudioBuffer = null;
        let jungleSourceNode = null;
        let isJunglePlaying = false;

        // 
        // TRACK MIXER SYSTEM - Multiple Audio Tracks with Fade Controls
        // 

        // Track configuration - files to load from public folder
        const trackConfig = {
            jungle: [
                'jungle-ambient.wav',
                'jungle-birds.wav',
                'jungle-rain.wav',
                'jungle-insects.wav'
            ],
            groovy: [
                'groovy-bass.wav',
                'groovy-rhythm.wav',
                'groovy-lead.wav'
            ],
            musicgen: [
                'generated-music.wav'
            ]
        };

        // Track storage
        const trackBuffers = {
            voice: null,
            jungle: {},
            groovy: {},
            musicgen: {}
        };

        const trackSources = {
            voice: null,
            jungle: {},
            groovy: {},
            musicgen: {}
        };

        const trackGains = {
            voice: null,
            jungle: {},
            groovy: {},
            musicgen: {}
        };

        const trackGroupGains = {
            voice: null,
            jungle: null,
            groovy: null,
            musicgen: null
        };

        async function loadJungleAmbience() {
            if (jungleAudioBuffer) return jungleAudioBuffer; // Already loaded
            
            try {
                console.log('Loading jungle-ambient.wav...');
                const response = await fetch('jungle-ambient.wav');
                if (!response.ok) {
                    console.warn('jungle-ambient.wav not found, jungle ambience will be silent');
                    return null;
                }
                
                const arrayBuffer = await response.arrayBuffer();
                jungleAudioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                console.log('Jungle ambience loaded successfully:', jungleAudioBuffer.duration, 'seconds');
                return jungleAudioBuffer;
            } catch (error) {
                console.warn('Error loading jungle ambience:', error);
                return null;
            }
        }

        function startJungleAmbience() {
            if (!audioCtx || !jungleGain || isJunglePlaying) return;
            
            // Load the audio file if not already loaded
            if (!jungleAudioBuffer) {
                loadJungleAmbience().then(buffer => {
                    if (buffer) {
                        playJungleAmbience();
                    }
                });
                return;
            }
            
            playJungleAmbience();
        }

        function playJungleAmbience() {
            if (!jungleAudioBuffer || !audioCtx || !jungleGain || isJunglePlaying) return;
            
            isJunglePlaying = true;
            
            // Create buffer source for looping
            jungleSourceNode = audioCtx.createBufferSource();
            jungleSourceNode.buffer = jungleAudioBuffer;
            jungleSourceNode.loop = true;
            
            // Connect to jungle gain (which goes to output)
            jungleSourceNode.connect(jungleGain);
            
            // Start playback
            jungleSourceNode.start(0);
            
            console.log('Jungle ambience started');
        }

        function stopJungleAmbience() {
            if (jungleSourceNode && isJunglePlaying) {
                try {
                    jungleSourceNode.stop();
                } catch (e) {
                    // Already stopped
                }
                jungleSourceNode.disconnect();
                jungleSourceNode = null;
                isJunglePlaying = false;
                console.log('Jungle ambience stopped');
            }
        }

        // Rain - filtered noise with modulation
        function playRain() {
            if (!audioCtx || !isPlaying) return;
            
            const duration = 4;
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(2, bufferSize, audioCtx.sampleRate);
            
            for (let ch = 0; ch < 2; ch++) {
                const data = buffer.getChannelData(ch);
                for (let i = 0; i < bufferSize; i++) {
                    // Layered noise for realistic rain
                    const t = i / audioCtx.sampleRate;
                    const mod = 0.7 + 0.3 * Math.sin(t * 0.5);
                    data[i] = (Math.random() * 2 - 1) * mod * 0.3;
                }
            }
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            noise.loop = true;
            
            // Rain filter - bandpass for that pitter-patter
            const hipass = audioCtx.createBiquadFilter();
            hipass.type = 'highpass';
            hipass.frequency.value = 2000;
            
            const lopass = audioCtx.createBiquadFilter();
            lopass.type = 'lowpass';
            lopass.frequency.value = 8000;
            
            const gain = audioCtx.createGain();
            gain.gain.value = 0.08 * synthParams.rainLevel;
            
            noise.connect(hipass);
            hipass.connect(lopass);
            lopass.connect(gain);
            gain.connect(jungleGain);
            
            noise.start();
            
            // Store references to update level in real-time
            noise._isRain = true;
            window._rainNode = noise;
            window._rainGain = gain;
        }

        // Exotic bird calls - frequency sweeps
        function playBirdCall() {
            if (!audioCtx || !isPlaying) return;
            
            const time = audioCtx.currentTime;
            const callType = Math.floor(Math.random() * 4);
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();
            
            osc.type = 'sine';
            filter.type = 'bandpass';
            filter.Q.value = 10;
            
            const baseFreq = 1500 + Math.random() * 2000;
            const level = 0.03 * synthParams.birdsLevel;
            
            if (callType === 0) {
                // Descending whistle
                osc.frequency.setValueAtTime(baseFreq + 800, time);
                osc.frequency.exponentialRampToValueAtTime(baseFreq, time + 0.3);
                filter.frequency.value = baseFreq + 400;
                gain.gain.setValueAtTime(level, time);
                gain.gain.linearRampToValueAtTime(0, time + 0.35);
            } else if (callType === 1) {
                // Two-tone chirp
                osc.frequency.setValueAtTime(baseFreq, time);
                osc.frequency.setValueAtTime(baseFreq + 400, time + 0.1);
                osc.frequency.setValueAtTime(baseFreq, time + 0.2);
                filter.frequency.value = baseFreq + 200;
                gain.gain.setValueAtTime(level * 0.8, time);
                gain.gain.setValueAtTime(level, time + 0.1);
                gain.gain.linearRampToValueAtTime(0, time + 0.3);
            } else if (callType === 2) {
                // Warbling trill
                const lfo = audioCtx.createOscillator();
                const lfoGain = audioCtx.createGain();
                lfo.frequency.value = 15;
                lfoGain.gain.value = 200;
                lfo.connect(lfoGain);
                lfoGain.connect(osc.frequency);
                lfo.start(time);
                lfo.stop(time + 0.6);
                osc.frequency.value = baseFreq;
                filter.frequency.value = baseFreq;
                gain.gain.setValueAtTime(0, time);
                gain.gain.linearRampToValueAtTime(level * 0.8, time + 0.1);
                gain.gain.linearRampToValueAtTime(0, time + 0.6);
            } else {
                // Ascending call
                osc.frequency.setValueAtTime(baseFreq - 300, time);
                osc.frequency.exponentialRampToValueAtTime(baseFreq + 500, time + 0.25);
                filter.frequency.value = baseFreq;
                gain.gain.setValueAtTime(level * 0.7, time);
                gain.gain.linearRampToValueAtTime(0, time + 0.3);
            }
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(jungleGain);
            
            osc.start(time);
            osc.stop(time + 0.7);
        }

        // Insect drones - high frequency oscillation
        function playInsects() {
            if (!audioCtx || !isPlaying) return;
            
            const time = audioCtx.currentTime;
            const duration = 1 + Math.random() * 2;
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sawtooth';
            osc.frequency.value = 4000 + Math.random() * 3000;
            
            // Amplitude modulation for buzzing
            const lfo = audioCtx.createOscillator();
            const lfoGain = audioCtx.createGain();
            lfo.frequency.value = 20 + Math.random() * 40;
            lfoGain.gain.value = 0.015 * synthParams.insectsLevel;
            
            const level = 0.015 * synthParams.insectsLevel;
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(level, time + 0.2);
            gain.gain.setValueAtTime(level, time + duration - 0.3);
            gain.gain.linearRampToValueAtTime(0, time + duration);
            
            lfo.connect(lfoGain);
            lfoGain.connect(gain.gain);
            
            osc.connect(gain);
            gain.connect(jungleGain);
            
            osc.start(time);
            lfo.start(time);
            osc.stop(time + duration);
            lfo.stop(time + duration);
        }

        // Distant thunder - low rumble with noise
        function playDistantThunder() {
            if (!audioCtx || !isPlaying) return;
            
            const time = audioCtx.currentTime;
            const duration = 3 + Math.random() * 2;
            
            // Sub rumble
            const osc = audioCtx.createOscillator();
            osc.type = 'sine';
            osc.frequency.value = 30 + Math.random() * 20;
            
            // Noise layer
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                const env = Math.exp(-i / (bufferSize * 0.3));
                data[i] = (Math.random() * 2 - 1) * env;
            }
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            
            const lopass = audioCtx.createBiquadFilter();
            lopass.type = 'lowpass';
            lopass.frequency.value = 200;
            
            const level = 0.15 * synthParams.thunderLevel;
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(level, time + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, time + duration);
            
            const oscGain = audioCtx.createGain();
            oscGain.gain.setValueAtTime(0.1 * synthParams.thunderLevel, time);
            oscGain.gain.exponentialRampToValueAtTime(0.001, time + duration);
            
            osc.connect(oscGain);
            oscGain.connect(jungleGain);
            
            noise.connect(lopass);
            lopass.connect(gain);
            gain.connect(jungleGain);
            
            osc.start(time);
            noise.start(time);
            osc.stop(time + duration);
            noise.stop(time + duration);
        }

        // Frogs - rhythmic croaking
        function playFrog() {
            if (!audioCtx || !isPlaying) return;
            
            const time = audioCtx.currentTime;
            const numCroaks = 2 + Math.floor(Math.random() * 3);
            
            for (let i = 0; i < numCroaks; i++) {
                const t = time + i * 0.15;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = 'square';
                const baseFreq = 150 + Math.random() * 100;
                osc.frequency.setValueAtTime(baseFreq, t);
                osc.frequency.exponentialRampToValueAtTime(baseFreq * 0.7, t + 0.08);
                
                gain.gain.setValueAtTime(0.03, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.1);
                
                osc.connect(gain);
                gain.connect(jungleGain);
                
                osc.start(t);
                osc.stop(t + 0.12);
            }
        }

        // Crickets - high pitched chirps
        function playCrickets() {
            if (!audioCtx || !isPlaying) return;
            
            const time = audioCtx.currentTime;
            const chirps = 3 + Math.floor(Math.random() * 4);
            
            for (let i = 0; i < chirps; i++) {
                const t = time + i * 0.05;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = 5000 + Math.random() * 2000;
                
                gain.gain.setValueAtTime(0.01, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.03);
                
                osc.connect(gain);
                gain.connect(jungleGain);
                
                osc.start(t);
                osc.stop(t + 0.04);
            }
        }

        // 
        // DARK TECHNO SYNTHESIZER VOICES
        // 

        // INDUSTRIAL KICK - harder, more distorted
        function playKick(time) {
            // Main body
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const dist = audioCtx.createWaveShaper();
            dist.curve = makeDistortionCurve(10);
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(synthParams.kickPunch, time);
            osc.frequency.exponentialRampToValueAtTime(28, time + 0.12);
            
            gain.gain.setValueAtTime(0.9, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + synthParams.kickDecay);
            
            osc.connect(dist);
            dist.connect(gain);
            gain.connect(masterGain);
            
            osc.start(time);
            osc.stop(time + synthParams.kickDecay + 0.1);
            
            // Click/punch - intensity based on kickPunch
            const click = audioCtx.createOscillator();
            const clickGain = audioCtx.createGain();
            click.type = 'square';
            click.frequency.value = 1000 + (synthParams.kickPunch * 3);
            clickGain.gain.setValueAtTime(0.1 + (synthParams.kickPunch / 2500), time);
            clickGain.gain.exponentialRampToValueAtTime(0.001, time + 0.015);
            
            click.connect(clickGain);
            clickGain.connect(masterGain);
            click.start(time);
            click.stop(time + 0.02);
            
            // Noise layer for grit
            const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.05, audioCtx.sampleRate);
            const noiseData = noiseBuffer.getChannelData(0);
            for (let i = 0; i < noiseBuffer.length; i++) {
                noiseData[i] = (Math.random() * 2 - 1) * Math.exp(-i / (noiseBuffer.length * 0.1));
            }
            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.value = 0.1;
            const noiseFilter = audioCtx.createBiquadFilter();
            noiseFilter.type = 'bandpass';
            noiseFilter.frequency.value = 3000;
            
            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(masterGain);
            noise.start(time);
        }

        // METALLIC CLAP/SNARE
        function playClap(time) {
            const layers = 4;
            for (let l = 0; l < layers; l++) {
                const t = time + l * 0.01;
                const bufferSize = audioCtx.sampleRate * 0.15;
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.15));
                }
                
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                
                const filter = audioCtx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.value = synthParams.clapSnap + l * 500;
                filter.Q.value = 2;
                
                const gain = audioCtx.createGain();
                gain.gain.setValueAtTime(0.12, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.12);
                
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(reverbGain);
                gain.connect(masterGain);
                
                noise.start(t);
            }
        }

        // GRITTY HI-HATS
        function playHat(time, open = false) {
            const bufferSize = audioCtx.sampleRate * (open ? 0.25 : 0.06);
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                // Add some harmonic content
                const t = i / audioCtx.sampleRate;
                data[i] = (Math.random() * 2 - 1 + Math.sin(t * 12000) * 0.2) 
                        * Math.exp(-i / (bufferSize * (open ? 0.4 : 0.2)));
            }
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            
            const hipass = audioCtx.createBiquadFilter();
            hipass.type = 'highpass';
            hipass.frequency.value = synthParams.hatBright;
            
            const gain = audioCtx.createGain();
            const decayTime = open ? synthParams.hatDecay * 3 : synthParams.hatDecay;
            gain.gain.setValueAtTime(open ? 0.08 : 0.12, time);
            
            noise.connect(hipass);
            hipass.connect(gain);
            gain.connect(masterGain);
            
            noise.start(time);
            noise.stop(time + decayTime + 0.02);
        }

        // DARK BASS - distorted and gritty
        function playBass(freq, time, duration) {
            const osc1 = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();
            const dist = audioCtx.createWaveShaper();
            
            dist.curve = makeDistortionCurve(synthParams.bassDrive);
            
            osc1.type = 'sawtooth';
            osc1.frequency.value = freq;
            
            osc2.type = 'square';
            osc2.frequency.value = freq * 0.995; // Slight detune
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(synthParams.bassFilter, time);
            filter.frequency.exponentialRampToValueAtTime(100, time + duration * 0.8);
            filter.Q.value = synthParams.bassReso;
            
            const level = 0.25 + (synthParams.subLevel * 0.2);
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(level, time + 0.01);
            gain.gain.setValueAtTime(level * 0.85, time + duration * 0.7);
            gain.gain.linearRampToValueAtTime(0, time + duration);
            
            osc1.connect(filter);
            osc2.connect(filter);
            filter.connect(dist);
            dist.connect(gain);
            gain.connect(masterGain);
            
            osc1.start(time);
            osc2.start(time);
            osc1.stop(time + duration + 0.1);
            osc2.stop(time + duration + 0.1);
        }

        // DARK PAD - ominous textures
        function playDarkPad(chord, time, duration) {
            chord.forEach((degree, i) => {
                const freq = noteToFreq(degree, 1);
                
                // Detuned layers - using synthParams.padDetune
                const detuneAmounts = [-synthParams.padDetune, -synthParams.padDetune/2, 0, synthParams.padDetune/2, synthParams.padDetune];
                detuneAmounts.forEach(detune => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    const filter = audioCtx.createBiquadFilter();
                    
                    osc.type = 'sawtooth';
                    osc.frequency.value = freq;
                    osc.detune.value = detune + Math.random() * 6 - 3;
                    
                    filter.type = 'lowpass';
                    filter.frequency.value = synthParams.padCutoff + Math.random() * 150;
                    filter.Q.value = 3;
                    
                    gain.gain.setValueAtTime(0, time);
                    gain.gain.linearRampToValueAtTime(0.03, time + 1.5);
                    gain.gain.setValueAtTime(0.03, time + duration - 2);
                    gain.gain.linearRampToValueAtTime(0, time + duration);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(reverbGain);
                    gain.connect(masterGain);
                    
                    osc.start(time);
                    osc.stop(time + duration + 0.5);
                });
            });
        }

        // INDUSTRIAL STAB - harsh metallic hit
        function playStab(degree, time) {
            const freq = noteToFreq(degree, 2);
            
            const osc1 = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();
            const dist = audioCtx.createWaveShaper();
            
            dist.curve = makeDistortionCurve(30);
            
            osc1.type = 'square';
            osc1.frequency.value = freq;
            
            osc2.type = 'sawtooth';
            osc2.frequency.value = freq * 1.5; // Fifth above
            
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(synthParams.stabFilter, time);
            filter.frequency.exponentialRampToValueAtTime(300, time + 0.15);
            filter.Q.value = 5;
            
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(0.15, time + synthParams.stabAttack);
            gain.gain.exponentialRampToValueAtTime(0.001, time + 0.2);
            
            osc1.connect(filter);
            osc2.connect(filter);
            filter.connect(dist);
            dist.connect(gain);
            gain.connect(reverbGain);
            gain.connect(masterGain);
            
            osc1.start(time);
            osc2.start(time);
            osc1.stop(time + 0.25);
            osc2.stop(time + 0.25);
        }

        // NOISE SWEEP - industrial texture
        function playNoiseSweep(time, up = true) {
            const duration = 2;
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.Q.value = 10;
            
            if (up) {
                filter.frequency.setValueAtTime(100, time);
                filter.frequency.exponentialRampToValueAtTime(8000, time + duration);
            } else {
                filter.frequency.setValueAtTime(8000, time);
                filter.frequency.exponentialRampToValueAtTime(100, time + duration);
            }
            
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0, time);
            gain.gain.linearRampToValueAtTime(0.08, time + duration * 0.5);
            gain.gain.linearRampToValueAtTime(0, time + duration);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(reverbGain);
            gain.connect(masterGain);
            
            noise.start(time);
            noise.stop(time + duration + 0.1);
        }

        // 
        // DARK SEQUENCER
        // 

        const STEPS_PER_BAR = 16;
        let barCount = 0;

        function scheduleNote() {
            const secondsPerBeat = 60.0 / bpm;
            const secondsPerStep = secondsPerBeat / 4;
            
            while (nextNoteTime < audioCtx.currentTime + 0.1) {
                const step = currentStep % STEPS_PER_BAR;
                const time = nextNoteTime;
                
                // New bar
                if (step === 0) {
                    const chord = CHORD_PROG[barCount % 4];
                    
                    // Dark pad every 2 bars
                    if (barCount % 2 === 0) {
                        playDarkPad(chord, time, secondsPerBeat * 8);
                    }
                    
                    // Noise sweep every 4 bars
                    if (barCount % 4 === 0 && barCount > 0) {
                        playNoiseSweep(time, barCount % 8 === 0);
                    }
                    
                    barCount++;
                }
                
                // KICK - four on floor with variations
                if (step % 4 === 0) {
                    playKick(time);
                }
                
                // Extra kick hits for drive
                if ((step === 10 || step === 14) && Math.random() < 0.4) {
                    playKick(time);
                }
                
                // CLAP on 4 and 12
                if (step === 4 || step === 12) {
                    playClap(time);
                }
                
                // HI-HATS - offbeat pattern
                if (step % 2 === 1) {
                    playHat(time, step === 7 || step === 15);
                }
                
                // Closed hats on beats
                if (step % 4 === 0 && Math.random() < 0.5) {
                    playHat(time + secondsPerStep * 0.5, false);
                }
                
                // BASS - syncopated pattern
                const bassPattern = [1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0];
                if (bassPattern[step]) {
                    const chord = CHORD_PROG[(barCount - 1) % 4];
                    const bassNote = chord[0];
                    playBass(noteToFreq(bassNote, 0), time, secondsPerStep * 1.5);
                }
                
                // STABS - occasional industrial hits
                if (step === 6 || step === 14) {
                    if (Math.random() < 0.6) {
                        const chord = CHORD_PROG[(barCount - 1) % 4];
                        playStab(chord[Math.floor(Math.random() * chord.length)], time);
                    }
                }
                
                // Extra stab variations
                if (step % 4 === 2 && Math.random() < 0.2) {
                    const chord = CHORD_PROG[(barCount - 1) % 4];
                    playStab(chord[1], time);
                }
                
                nextNoteTime += secondsPerStep;
                currentStep++;
            }
        }

        // 
        // VISUALIZER
        // 

        const visualizer = document.getElementById('visualizer');
        const NUM_BARS = 32;
        const vizBars = [];

        for (let i = 0; i < NUM_BARS; i++) {
            const bar = document.createElement('div');
            bar.className = 'viz-bar';
            visualizer.appendChild(bar);
            vizBars.push(bar);
        }

        function updateVisualizer() {
            if (!analyser || !isPlaying) {
                vizBars.forEach(bar => bar.style.height = '3px');
                return;
            }
            
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);
            
            vizBars.forEach((bar, i) => {
                const value = dataArray[i] || 0;
                const height = Math.max(3, (value / 255) * 70);
                bar.style.height = height + 'px';
            });
            
            // Update world effects based on audio
            updateWorldEffects(dataArray);
            
            if (isPlaying) {
                requestAnimationFrame(updateVisualizer);
            }
        }

        // 
        // WORLD EFFECTS - Audio Reactive
        // 

        let worldContainer = null;
        let horseSvg = null;
        let lastBassHit = 0;

        // Initialize world effects
        function initWorldEffects() {
            worldContainer = document.querySelector('.world-container');
            horseSvg = document.querySelector('#horseSvg');
            
            if (worldContainer && !document.querySelector('.world-container .world-particles')) {
                // Add particles container to world
                const worldParticlesContainer = document.createElement('div');
                worldParticlesContainer.className = 'world-particles';
                worldContainer.appendChild(worldParticlesContainer);

                // Create floating particles
                for (let i = 0; i < 30; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'world-particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 4 + 's';
                    particle.style.animationDuration = (3 + Math.random() * 2) + 's';
                    worldParticlesContainer.appendChild(particle);
                }
            }
        }

        function updateWorldEffects(frequencyData) {
            if (!worldContainer || !horseSvg) {
                initWorldEffects();
                if (!worldContainer || !horseSvg) return;
            }

            // Calculate audio intensity
            const bassIntensity = frequencyData.slice(0, 10).reduce((a, b) => a + b, 0) / 2550;
            const midIntensity = frequencyData.slice(10, 30).reduce((a, b) => a + b, 0) / 5100;
            const highIntensity = frequencyData.slice(30, 60).reduce((a, b) => a + b, 0) / 7650;
            const overallIntensity = (bassIntensity + midIntensity + highIntensity) / 3;

            // Update world container classes based on audio
            if (overallIntensity > 0.3) {
                worldContainer.classList.add('audio-active');
            } else {
                worldContainer.classList.remove('audio-active');
            }

            // Bass reactive effects
            if (bassIntensity > 0.4) {
                worldContainer.classList.add('bass-active');
                lastBassHit = Date.now();
            } else if (Date.now() - lastBassHit > 500) {
                worldContainer.classList.remove('bass-active');
            }

            // Distortion effects (based on high frequencies)
            if (highIntensity > 0.5) {
                worldContainer.classList.add('distortion-active');
            } else {
                worldContainer.classList.remove('distortion-active');
            }

            // Jungle effects (based on mid frequencies)
            if (midIntensity > 0.4) {
                worldContainer.classList.add('jungle-active');
            } else {
                worldContainer.classList.remove('jungle-active');
            }

            // Update horse wandering speed based on intensity
            if (horseSvg) {
                horseSvg.classList.remove('wandering-fast', 'wandering-slow', 'wandering');
                if (overallIntensity > 0.5) {
                    horseSvg.classList.add('wandering-fast');
                } else if (overallIntensity < 0.2) {
                    horseSvg.classList.add('wandering-slow');
                } else {
                    horseSvg.classList.add('wandering');
                }
            }
        }

        // Initialize on load
        initWorldEffects();

        // 
        // CONTROLS
        // 

        const playBtn = document.getElementById('playBtn');
        const statusDot = document.getElementById('statusDot');
        const volumeSlider = document.getElementById('volumeSlider');
        const tempoSlider = document.getElementById('tempoSlider');
        const tempoValue = document.getElementById('tempoValue');

        playBtn.addEventListener('click', async () => {
            if (!audioCtx) {
                initAudio();
            }
            
            if (audioCtx.state === 'suspended') {
                await audioCtx.resume();
            }
            
            if (isPlaying) {
                // Stop
                isPlaying = false;
                clearInterval(schedulerInterval);
                
                // Stop all track mixer groups
                Object.keys(trackSources.jungle).forEach(fileName => {
                    stopTrack('jungle', fileName);
                });
                Object.keys(trackSources.groovy).forEach(fileName => {
                    stopTrack('groovy', fileName);
                });
                Object.keys(trackSources.musicgen).forEach(fileName => {
                    stopTrack('musicgen', fileName);
                });
                
                playBtn.classList.remove('playing');
                statusDot.classList.remove('active');
            } else {
                // Start
                isPlaying = true;
                nextNoteTime = audioCtx.currentTime;
                currentStep = 0;
                barCount = 0;
                
                schedulerInterval = setInterval(scheduleNote, 25);
                
                // Start track mixer groups if enabled (only individual tracks that are checked)
                if (document.getElementById('trackJungleToggle')?.checked) {
                    trackConfig.jungle.forEach((fileName, index) => {
                        const trackId = ['trackJungleAmbient', 'trackJungleBirds', 'trackJungleRain', 'trackJungleInsects'][index];
                        const trackCheckbox = document.getElementById(trackId);
                        if (trackCheckbox && trackCheckbox.checked && trackBuffers.jungle[fileName] && !trackSources.jungle[fileName]) {
                            playTrack('jungle', fileName, true);
                        }
                    });
                }
                if (document.getElementById('trackGroovyToggle')?.checked) {
                    trackConfig.groovy.forEach((fileName, index) => {
                        const trackId = ['trackGroovyBass', 'trackGroovyRhythm', 'trackGroovyLead'][index];
                        const trackCheckbox = document.getElementById(trackId);
                        if (trackCheckbox && trackCheckbox.checked && trackBuffers.groovy[fileName] && !trackSources.groovy[fileName]) {
                            playTrack('groovy', fileName, true);
                        }
                    });
                }

                if (document.getElementById('trackMusicGenToggle')?.checked) {
                    trackConfig.musicgen.forEach((fileName) => {
                        const trackCheckbox = document.getElementById('trackMusicGenMain');
                        if (trackCheckbox && trackCheckbox.checked && trackBuffers.musicgen[fileName] && !trackSources.musicgen[fileName]) {
                            playTrack('musicgen', fileName, true);
                        }
                    });
                }

                playBtn.classList.add('playing');
                statusDot.classList.add('active');
                updateVisualizer();
            }
        });

        volumeSlider.addEventListener('input', (e) => {
            if (masterGain) {
                masterGain.gain.value = e.target.value / 100 * 0.7;
            }
        });

        tempoSlider.addEventListener('input', (e) => {
            bpm = parseInt(e.target.value);
            tempoValue.textContent = bpm;
        });

        // 
        // PROFESSIONAL DJ TOOLBOX: EQ & FILTER CONTROLS
        // 

        const eqLowSlider = document.getElementById('eqLow');
        const eqLowValue = document.getElementById('eqLowValue');
        const eqMidSlider = document.getElementById('eqMid');
        const eqMidValue = document.getElementById('eqMidValue');
        const eqHighSlider = document.getElementById('eqHigh');
        const eqHighValue = document.getElementById('eqHighValue');

        eqLowSlider.addEventListener('input', (e) => {
            const gain = parseFloat(e.target.value);
            eqLowValue.textContent = gain > 0 ? `+${gain}` : gain;
            if (eqLow) {
                eqLow.gain.value = gain;
            }
        });

        eqMidSlider.addEventListener('input', (e) => {
            const gain = parseFloat(e.target.value);
            eqMidValue.textContent = gain > 0 ? `+${gain}` : gain;
            if (eqMid) {
                eqMid.gain.value = gain;
            }
        });

        eqHighSlider.addEventListener('input', (e) => {
            const gain = parseFloat(e.target.value);
            eqHighValue.textContent = gain > 0 ? `+${gain}` : gain;
            if (eqHigh) {
                eqHigh.gain.value = gain;
            }
        });

        const filterCutoffSlider = document.getElementById('filterCutoff');
        const filterCutoffValue = document.getElementById('filterCutoffValue');
        const filterResSlider = document.getElementById('filterRes');
        const filterResValue = document.getElementById('filterResValue');
        const filterBtns = document.querySelectorAll('.filter-btn');

        filterCutoffSlider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            filterCutoffValue.textContent = value;
            if (djFilter) {
                // Map 0-100 to 20Hz-20kHz logarithmic
                const freq = 20 * Math.pow(20000 / 20, value / 100);
                djFilter.frequency.value = freq;
            }
        });

        filterResSlider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            filterResValue.textContent = value;
            if (djFilter) {
                // Map 0-100 to Q 0.1-30
                djFilter.Q.value = 0.1 + (value / 100) * 29.9;
            }
        });

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterType = btn.dataset.filter;
                if (djFilter) {
                    djFilter.type = filterType === 'hp' ? 'highpass' : filterType === 'bp' ? 'bandpass' : 'lowpass';
                }
            });
        });

        // 
        // LOSSLESS WAV RECORDING SYSTEM
        // 320kHz / 32-bit float - Professional quality
        // 

        let mediaRecorder = null;
        let recordedChunks = [];
        let recordingStartTime = null;
        let recordingTimerInterval = null;
        let recordingDestination = null;
        let isRecording = false;
        let recordingMixer = null;
        let recordingSources = {
            master: true,   // Drums, drops, funky sounds
            voice: true,    // Speech/narration
            jungle: true    // Nature sounds
        };
        
        // Recording mixer nodes for each source
        let recordingMasterGain = null;
        let recordingVoiceGain = null;
        let recordingJungleGain = null;
        
        // Voice effects chain
        let voiceGain = null;
        let voiceReverb = null;
        let voiceEQ = null;
        let voiceFilter = null;
        let voiceDistortion = null;
        let voiceStereoWidth = null;
        let voiceChannelSplitter = null;
        let voiceChannelMerger = null;

        const recordBtn = document.getElementById('recordBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const recordStatus = document.getElementById('recordStatus');
        const recordTime = document.getElementById('recordTime');

        // Create WAV file from audio buffer (lossless 32-bit float)
        function audioBufferToWav(buffer) {
            const numChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const format = 3; // IEEE float
            const bitDepth = 32;
            
            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;
            
            const samples = buffer.length;
            const dataSize = samples * blockAlign;
            const bufferSize = 44 + dataSize;
            
            const arrayBuffer = new ArrayBuffer(bufferSize);
            const view = new DataView(arrayBuffer);
            
            // WAV Header
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataSize, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // fmt chunk size
            view.setUint16(20, format, true); // format (3 = IEEE float)
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * blockAlign, true); // byte rate
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);
            writeString(view, 36, 'data');
            view.setUint32(40, dataSize, true);
            
            // Interleave channels and write 32-bit float samples
            const offset = 44;
            const channelData = [];
            for (let ch = 0; ch < numChannels; ch++) {
                channelData.push(buffer.getChannelData(ch));
            }
            
            for (let i = 0; i < samples; i++) {
                for (let ch = 0; ch < numChannels; ch++) {
                    view.setFloat32(offset + (i * numChannels + ch) * 4, channelData[ch][i], true);
                }
            }
            
            return new Blob([arrayBuffer], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // Start recording using ScriptProcessor for raw sample capture
        async function startRecording() {
            if (!audioCtx || isRecording) return;
            
            // Record whatever is currently selected/playing in the UI
            // Master (drums/drops/funky) - always record if main playback is active
            recordingSources.master = isPlaying;
            // Voice - record if voice group is enabled in track mixer
            recordingSources.voice = document.getElementById('trackVoiceToggle')?.checked || false;
            // Jungle/Nature - record if jungle group is enabled in track mixer (includes all jungle tracks)
            recordingSources.jungle = document.getElementById('trackJungleToggle')?.checked || false;
            
            try {
                // Create recording mixer (final output node)
                recordingMixer = audioCtx.createGain();
                recordingMixer.gain.value = 1.0;
                
                // Create individual gain nodes for each source
                recordingMasterGain = audioCtx.createGain();
                recordingVoiceGain = audioCtx.createGain();
                recordingJungleGain = audioCtx.createGain();
                
                // Set gain based on source selection
                recordingMasterGain.gain.value = recordingSources.master ? 1.0 : 0.0;
                recordingVoiceGain.gain.value = recordingSources.voice ? 1.0 : 0.0;
                recordingJungleGain.gain.value = recordingSources.jungle ? 1.0 : 0.0;
                
                // Route master synth (drums, drops, funky sounds) through analyser
                // Disconnect analyser from destination temporarily
                analyser.disconnect();
                
                // Connect analyser to recording master gain, then to mixer
                analyser.connect(recordingMasterGain);
                recordingMasterGain.connect(recordingMixer);
                
                // Also connect analyser back to destination for playback
                analyser.connect(audioCtx.destination);
                
                // Route voice through recording voice gain
                // Voice signal flows through voiceReverb (a GainNode)
                // In Web Audio API, we can connect a node to multiple destinations
                // So we connect voiceReverb to recordingVoiceGain in addition to existing connections
                if (recordingSources.voice && voiceReverb) {
                    voiceReverb.connect(recordingVoiceGain);
                    recordingVoiceGain.connect(recordingMixer);
                }
                
                // Route jungle sounds through recording jungle gain
                if (recordingSources.jungle && jungleGain) {
                    // Disconnect jungleGain from destination temporarily
                    jungleGain.disconnect();
                    
                    // Connect to both recording and destination
                    jungleGain.connect(recordingJungleGain);
                    recordingJungleGain.connect(recordingMixer);
                    jungleGain.connect(audioCtx.destination);
                }
                
                // Create a script processor to capture raw samples
                const bufferSize = 4096;
                const recorder = audioCtx.createScriptProcessor(bufferSize, 2, 2);
                
                // Store samples in Float32 arrays (lossless)
                recorder.onaudioprocess = (e) => {
                    if (!isRecording) return;
                    
                    const left = new Float32Array(e.inputBuffer.getChannelData(0));
                    const right = new Float32Array(e.inputBuffer.getChannelData(1));
                    recordedChunks.push({ left, right });
                };
                
                // Connect recording mixer to recorder, then to destination for monitoring
                recordingMixer.connect(recorder);
                recorder.connect(audioCtx.destination);
                
                // Store reference for cleanup
                recordingDestination = recorder;
                
                isRecording = true;
                recordedChunks = [];
                recordingStartTime = Date.now();
                
                // Build status text
                const sources = [];
                if (recordingSources.master) sources.push('Drums');
                if (recordingSources.voice) sources.push('Voice');
                if (recordingSources.jungle) sources.push('Nature');
                const statusText = 'Recording (' + sources.join(' + ') + ')';
                
                // Update UI
                recordBtn.classList.add('recording');
                recordStatus.textContent = statusText;
                recordStatus.classList.add('recording');
                downloadBtn.disabled = true;
                
                // Start timer
                recordingTimerInterval = setInterval(updateRecordingTime, 100);
            } catch (err) {
                console.error('Error starting recording:', err);
                recordStatus.textContent = 'Recording failed';
                alert('Error starting recording: ' + err.message);
            }
        }

        function stopRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            
            // Disconnect recorder
            if (recordingDestination) {
                recordingDestination.disconnect();
                recordingDestination = null;
            }
            
            // Disconnect recording mixer
            if (recordingMixer) {
                recordingMixer.disconnect();
                recordingMixer = null;
            }
            
            // Disconnect recording source gains
            // Note: analyser and jungleGain remain connected to destination
            // We only disconnect the recording-specific connections
            if (recordingMasterGain) {
                analyser.disconnect(recordingMasterGain);
                recordingMasterGain.disconnect();
                recordingMasterGain = null;
            }
            
            if (recordingVoiceGain && voiceReverb) {
                voiceReverb.disconnect(recordingVoiceGain);
                recordingVoiceGain.disconnect();
                recordingVoiceGain = null;
            }
            
            if (recordingJungleGain && jungleGain) {
                jungleGain.disconnect(recordingJungleGain);
                recordingJungleGain.disconnect();
                recordingJungleGain = null;
            }
            
            // Stop timer
            clearInterval(recordingTimerInterval);
            
            // Update UI
            recordBtn.classList.remove('recording');
            recordStatus.textContent = 'Processing...';
            recordStatus.classList.remove('recording');
            
            // Process recorded chunks into WAV
            setTimeout(() => {
                if (recordedChunks.length > 0) {
                    processRecording();
                } else {
                    recordStatus.textContent = 'No audio captured';
                }
            }, 100);
        }

        function processRecording() {
            // Calculate total samples
            const totalSamples = recordedChunks.reduce((acc, chunk) => acc + chunk.left.length, 0);
            
            // Create audio buffer
            const buffer = audioCtx.createBuffer(2, totalSamples, audioCtx.sampleRate);
            const leftChannel = buffer.getChannelData(0);
            const rightChannel = buffer.getChannelData(1);
            
            // Copy all chunks
            let offset = 0;
            recordedChunks.forEach(chunk => {
                leftChannel.set(chunk.left, offset);
                rightChannel.set(chunk.right, offset);
                offset += chunk.left.length;
            });
            
            // Convert to WAV
            const wavBlob = audioBufferToWav(buffer);
            
            // Create download link
            const url = URL.createObjectURL(wavBlob);
            downloadBtn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
                a.download = `hinoeuma-${audioCtx.sampleRate}hz-32bit-${duration}s.wav`;
                a.click();
            };
            
            // Update UI
            const fileSizeMB = (wavBlob.size / (1024 * 1024)).toFixed(1);
            recordStatus.textContent = `Ready (${fileSizeMB} MB)`;
            downloadBtn.disabled = false;
        }

        function updateRecordingTime() {
            if (!recordingStartTime) return;
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            recordTime.textContent = `${minutes}:${seconds}`;
        }

        recordBtn.addEventListener('click', () => {
            if (!audioCtx) {
                alert('Please start playback first before recording.');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });

        // 
        // KNOB CONTROLLER SYSTEM - 22 Real-time Performance Knobs
        // 

        // Parameter storage with defaults
        const params = {
            // Drums
            kickPunch: 70,
            kickDecay: 50,
            clapSnap: 60,
            hatBright: 65,
            hatDecay: 40,
            // Bass
            bassFilter: 45,
            bassReso: 55,
            bassDrive: 60,
            subLevel: 70,
            // Synths
            padCutoff: 35,
            padDetune: 50,
            stabAttack: 75,
            stabFilter: 60,
            // Effects
            distortion: 50,
            reverbMix: 40,
            reverbDark: 55,
            compression: 65,
            // Jungle
            jungleLevel: 35,
            rainLevel: 50,
            birdsLevel: 45,
            insectsLevel: 40,
            thunderLevel: 30
        };

        // Knob interaction state
        let activeKnob = null;
        let knobStartY = 0;
        let knobStartValue = 0;

        // Initialize all knobs
        function initKnobs() {
            const knobs = document.querySelectorAll('.knob');
            
            knobs.forEach(knob => {
                const param = knob.dataset.param;
                const value = parseInt(knob.dataset.value);
                params[param] = value;
                updateKnobVisual(knob, value);
                
                // Mouse events
                knob.addEventListener('mousedown', startKnobDrag);
                
                // Touch events
                knob.addEventListener('touchstart', startKnobDrag, { passive: false });
                
                // Double-click to reset
                knob.addEventListener('dblclick', resetKnob);
            });
            
            // Global mouse/touch move and up
            document.addEventListener('mousemove', dragKnob);
            document.addEventListener('mouseup', stopKnobDrag);
            document.addEventListener('touchmove', dragKnob, { passive: false });
            document.addEventListener('touchend', stopKnobDrag);
        }

        function startKnobDrag(e) {
            e.preventDefault();
            activeKnob = e.currentTarget;
            activeKnob.classList.add('dragging');
            
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            knobStartY = clientY;
            knobStartValue = parseInt(activeKnob.dataset.value);
        }

        function dragKnob(e) {
            if (!activeKnob) return;
            e.preventDefault();
            
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const deltaY = knobStartY - clientY;
            const sensitivity = 2; // pixels per unit
            
            let newValue = knobStartValue + Math.round(deltaY / sensitivity);
            const min = parseInt(activeKnob.dataset.min);
            const max = parseInt(activeKnob.dataset.max);
            newValue = Math.max(min, Math.min(max, newValue));
            
            activeKnob.dataset.value = newValue;
            updateKnobVisual(activeKnob, newValue);
            
            // Update parameter
            const param = activeKnob.dataset.param;
            params[param] = newValue;
            applyParameter(param, newValue);
        }

        function stopKnobDrag() {
            if (activeKnob) {
                activeKnob.classList.remove('dragging');
                activeKnob = null;
            }
        }

        function resetKnob(e) {
            const knob = e.currentTarget;
            const param = knob.dataset.param;
            const defaultValue = 50; // Default to center
            
            knob.dataset.value = defaultValue;
            params[param] = defaultValue;
            updateKnobVisual(knob, defaultValue);
            applyParameter(param, defaultValue);
        }

        function updateKnobVisual(knob, value) {
            const min = parseInt(knob.dataset.min);
            const max = parseInt(knob.dataset.max);
            const normalized = (value - min) / (max - min);
            
            // Rotation: -135deg to +135deg (270deg range)
            const rotation = -135 + (normalized * 270);
            const indicator = knob.querySelector('.knob-indicator');
            indicator.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
            
            // Update ring progress (conic gradient)
            const progressDeg = normalized * 270;
            knob.style.setProperty('--knob-progress', `${progressDeg}deg`);
            
            // Update value display
            const container = knob.closest('.knob-container');
            const valueDisplay = container.querySelector('.knob-value');
            if (valueDisplay) {
                valueDisplay.textContent = value;
            }
        }

        // Apply parameter changes to the audio engine in real-time
        function applyParameter(param, value) {
            const normalized = value / 100;
            
            switch(param) {
                //  DRUMS 
                case 'kickPunch':
                    synthParams.kickPunch = 100 + normalized * 150; // 100-250 Hz start freq
                    break;
                case 'kickDecay':
                    synthParams.kickDecay = 0.2 + normalized * 0.6; // 0.2-0.8s decay
                    break;
                case 'clapSnap':
                    synthParams.clapSnap = 1000 + normalized * 2000; // 1000-3000 Hz
                    break;
                case 'hatBright':
                    synthParams.hatBright = 5000 + normalized * 8000; // 5000-13000 Hz
                    break;
                case 'hatDecay':
                    synthParams.hatDecay = 0.03 + normalized * 0.2; // 0.03-0.23s
                    break;
                    
                //  BASS 
                case 'bassFilter':
                    synthParams.bassFilter = 100 + normalized * 1500; // 100-1600 Hz
                    break;
                case 'bassReso':
                    synthParams.bassReso = 1 + normalized * 20; // Q 1-21
                    break;
                case 'bassDrive':
                    synthParams.bassDrive = 5 + normalized * 35; // Distortion 5-40
                    break;
                case 'subLevel':
                    synthParams.subLevel = normalized; // 0-1
                    break;
                    
                //  SYNTHS 
                case 'padCutoff':
                    synthParams.padCutoff = 150 + normalized * 800; // 150-950 Hz
                    break;
                case 'padDetune':
                    synthParams.padDetune = normalized * 25; // 0-25 cents
                    break;
                case 'stabAttack':
                    synthParams.stabAttack = 0.001 + (1 - normalized) * 0.05; // Inverted: high = fast
                    break;
                case 'stabFilter':
                    synthParams.stabFilter = 500 + normalized * 3500; // 500-4000 Hz
                    break;
                    
                //  EFFECTS 
                case 'distortion':
                    if (distortionNode) {
                        distortionNode.curve = makeDistortionCurve(5 + normalized * 45);
                    }
                    break;
                case 'reverbMix':
                    if (reverbGain) {
                        reverbGain.gain.value = normalized * 0.6;
                    }
                    break;
                case 'reverbDark':
                    synthParams.reverbDark = 500 + (1 - normalized) * 2000; // Inverted: high = darker
                    break;
                case 'compression':
                    if (compressor) {
                        compressor.ratio.value = 2 + normalized * 14; // 2:1 to 16:1
                        compressor.threshold.value = -12 - normalized * 24; // -12 to -36 dB
                    }
                    break;
                    
                //  JUNGLE AMBIENCE 
                case 'jungleLevel':
                    if (jungleGain) {
                        jungleGain.gain.value = normalized * 0.35;
                    }
                    break;
                case 'rainLevel':
                    synthParams.rainLevel = normalized;
                    if (window._rainGain) {
                        window._rainGain.gain.value = 0.08 * normalized;
                    }
                    break;
                case 'birdsLevel':
                    synthParams.birdsLevel = normalized;
                    break;
                case 'insectsLevel':
                    synthParams.insectsLevel = normalized;
                    break;
                case 'thunderLevel':
                    synthParams.thunderLevel = normalized;
                    break;
            }
        }

        // Initialize knobs on page load
        initKnobs();

        // 
        // VOICE NARRATION SYSTEM - Fire Horse Script
        // 

        const fireHorseScript = `Friends, fellow travelers, and anyone who accidentally clicked this link,
Tonight we call in the Fire Horse. Not as some dusty myth, but as a force of becoming. Also, arguably, the best excuse for a party in sixty years.
The Fire Horse is movement and ignition. It's that moment when Netflix asks if you're still watching and you say no, actually, I'm going outside. It is courage without permission. Life refusing to shrink. Spreadsheets refusing to define us.
In every culture, the horse has been a bridge: between human and wild, between earth and horizon, between instinct and that thing your therapist keeps asking about.
And fire? Fire is transformation. It clears what is stagnant. It tempers what is raw. It also makes excellent s'mores, but that's beside the point.
Together, Fire and Horse are not chaos. They are momentum with purpose. Think less "everything is on fire" and more "controlled burn with good vibes."
We stand at the edge of an era that has exhausted itself. An era of separation: humans from nature, economies from ecology, work emails from any sense of meaning whatsoever.
The Fire Horse does not ask politely for change. It arrives when systems can no longer pretend they are alive. When algorithms recommend you videos of algorithms. When your smart fridge judges your midnight cheese habits.
This is not an ending. This is a reboot. The good kind, not the Hollywood kind.
A remembering.
The Fire Horse teaches us that humanity was never meant to dominate nature, nor disappear into it, but to dance with it. Awkwardly at first, sure. Everyone's awkward at first.
To become keystone species again. Caretakers with creativity. Engineers with reverence. People who compost and won't shut up about it, but in a charming way.
Playfulness returns here. Because regeneration is not grim labor. It is joyful participation in life's intelligence. If you're not occasionally laughing, you might be doing it wrong.
Soil rebuilding itself. Water finding new paths. Communities re-learning how to trust, or at least how to share tools without being weird about it.
Laughter is not a distraction from the work. It is proof the work is aligned. The mycelium network definitely has inside jokes. We just can't hear them yet.
And yes, we carry tools now our ancestors could not imagine. They also couldn't imagine TikTok, so let's use discernment.
Technology is not the enemy of nature. Extraction is. When technology serves life, it becomes a liberation tool. When it serves engagement metrics, it becomes a problem.
Sensors that listen to forests. Networks that coordinate stewardship. Systems that reward regeneration instead of quarterly growth. Revolutionary stuff. Also: common sense, if you think about it.
The Fire Horse does not reject technology. It tames it, rides it, occasionally checks its screen time and sighs deeply.
This is a call to boldness. Not recklessness. Boldness. There's a difference. Look it up. Actually, you probably shouldn't look it up right now. Stay present.
To live faster where life needs speed, and slower where wisdom grows. To know the difference. To stop doom-scrolling. Seriously. This is your sign.
To choose courage over comfort. Regeneration over convenience. Actual community over followers.
The Fire Horse runs with those who refuse to be small. Who dare to imagine civilizations that last seven generations, not seven news cycles.
So let us run. Not from anything. Toward something.
With the land beneath us. With the fire within us. With technology in service, not command. With snacks, probably. Revolutions need snacks.
May we merge back into the living world. Not by losing ourselves, but by finally becoming fully human. Which, for the record, includes rest. And joy. And the occasional terrible pun.
Welcome, Fire Horse. Run through us. Try not to knock over the furniture.`;

        let voiceAudioBuffer = null;
        let voiceSourceNode = null;
        let isSpeaking = false;

        const voiceBtn = document.getElementById('voiceBtn');
        const voiceProgressBar = document.getElementById('voiceProgressBar');
        const voiceStatusEl = document.getElementById('voiceStatus');

        // Voice parameter values (with defaults)
        let voiceVolume = 80; // Default to 80% (matches default voiceGain of 0.8)

        // Update voice parameter displays and values
        function updateVoiceParamDisplays() {
            // Update all matching display elements (in case there are duplicates)
            document.querySelectorAll('#voiceVolumeValue').forEach(el => {
                el.textContent = voiceVolume;
            });
            // Sync all sliders
            document.querySelectorAll('#voiceVolume').forEach(el => {
                el.value = voiceVolume;
            });
        }
        document.querySelectorAll('#voiceVolume').forEach(slider => {
            slider.addEventListener('input', (e) => {
                voiceVolume = parseInt(e.target.value);
                updateVoiceParamDisplays();
                // Update voice gain in real-time (scale 0-100 to 0-1)
                if (voiceGain) {
                    voiceGain.gain.value = voiceVolume / 100;
                }
            });
        });
        
        // Voice Effects Controls
        const voiceEQLowSlider = document.getElementById('voiceEQLow');
        const voiceEQLowValue = document.getElementById('voiceEQLowValue');
        const voiceEQMidSlider = document.getElementById('voiceEQMid');
        const voiceEQMidValue = document.getElementById('voiceEQMidValue');
        const voiceEQHighSlider = document.getElementById('voiceEQHigh');
        const voiceEQHighValue = document.getElementById('voiceEQHighValue');
        const voiceFilterSlider = document.getElementById('voiceFilter');
        const voiceFilterValue = document.getElementById('voiceFilterValue');
        const voiceReverbSlider = document.getElementById('voiceReverb');
        const voiceReverbValue = document.getElementById('voiceReverbValue');
        const voiceDistortionSlider = document.getElementById('voiceDistortion');
        const voiceDistortionValue = document.getElementById('voiceDistortionValue');
        
        if (voiceEQLowSlider) {
            voiceEQLowSlider.addEventListener('input', (e) => {
                const gain = parseFloat(e.target.value);
                voiceEQLowValue.textContent = gain > 0 ? `+${gain.toFixed(1)}` : gain.toFixed(1);
                if (voiceEQ && voiceEQ.low) {
                    voiceEQ.low.gain.value = gain;
                }
            });
        }
        
        if (voiceEQMidSlider) {
            voiceEQMidSlider.addEventListener('input', (e) => {
                const gain = parseFloat(e.target.value);
                voiceEQMidValue.textContent = gain > 0 ? `+${gain.toFixed(1)}` : gain.toFixed(1);
                if (voiceEQ && voiceEQ.mid) {
                    voiceEQ.mid.gain.value = gain;
                }
            });
        }
        
        if (voiceEQHighSlider) {
            voiceEQHighSlider.addEventListener('input', (e) => {
                const gain = parseFloat(e.target.value);
                voiceEQHighValue.textContent = gain > 0 ? `+${gain.toFixed(1)}` : gain.toFixed(1);
                if (voiceEQ && voiceEQ.high) {
                    voiceEQ.high.gain.value = gain;
                }
            });
        }
        
        if (voiceFilterSlider) {
            voiceFilterSlider.addEventListener('input', (e) => {
                const freq = parseInt(e.target.value);
                voiceFilterValue.textContent = freq >= 1000 ? `${(freq / 1000).toFixed(1)}k` : freq;
                if (voiceFilter) {
                    voiceFilter.frequency.value = freq;
                }
            });
        }
        
        if (voiceReverbSlider) {
            voiceReverbSlider.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                voiceReverbValue.textContent = value;
                if (voiceReverb) {
                    voiceReverb.gain.value = value / 100; // Scale 0-100 to 0-1
                }
            });
        }
        
        if (voiceDistortionSlider) {
            voiceDistortionSlider.addEventListener('input', (e) => {
                const amount = parseInt(e.target.value);
                voiceDistortionValue.textContent = amount;
                if (voiceDistortion && typeof makeDistortionCurve === 'function') {
                    voiceDistortion.curve = makeDistortionCurve(amount);
                }
            });
        }

        // Initialize display values on load
        updateVoiceParamDisplays();

        // Voice is now loaded from WAV file, no speech synthesis needed

        // Load and play fire-horse-speech.wav
        async function startNarration() {
            if (!audioCtx) {
                initAudio();
            }
            
            if (audioCtx.state === 'suspended') {
                await audioCtx.resume();
            }
            
            // Stop any currently playing voice
            stopNarration();
            
            if (voiceAudioBuffer) {
                // Already loaded, just play it
                playVoiceAudio();
                return;
            }
            
            // Load the WAV file
            if (voiceStatusEl) voiceStatusEl.textContent = 'Loading...';
            
            try {
                console.log('Loading fire-horse-speech.wav...');
                const response = await fetch('fire-horse-speech.wav');
                console.log('Fetch response:', response.status, response.statusText);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                console.log('Decoding audio data...');
                const arrayBuffer = await response.arrayBuffer();
                voiceAudioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                console.log('Audio loaded successfully:', voiceAudioBuffer.duration, 'seconds');
                
                playVoiceAudio();
            } catch (error) {
                console.error('Error loading voice audio:', error);
                if (voiceStatusEl) voiceStatusEl.textContent = 'Load failed';
                
                // More helpful error message
                let errorMsg = 'Failed to load fire-horse-speech.wav. ';
                if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
                    errorMsg += 'If opening as file://, please use a local web server:\n\n';
                    errorMsg += 'cd public && python3 -m http.server 8000\n';
                    errorMsg += 'Then open http://localhost:8000';
                } else if (error.message.includes('404')) {
                    errorMsg += 'File not found. Ensure fire-horse-speech.wav exists in the public/ directory.';
                } else {
                    errorMsg += error.message;
                }
                alert(errorMsg);
            }
        }
        
        function playVoiceAudio() {
            if (!voiceAudioBuffer || !audioCtx) return;
            
            isSpeaking = true;
            
            if (voiceBtn) voiceBtn.classList.add('speaking');
            if (voiceStatusEl) {
                voiceStatusEl.textContent = 'Speaking...';
                voiceStatusEl.classList.add('speaking');
            }
            
            // Slightly duck the music
            if (masterGain) {
                masterGain.gain.value = 0.4;
            }
            
            // Create buffer source - resample to 320kHz if needed
            voiceSourceNode = audioCtx.createBufferSource();
            
            // If sample rate differs, we need to handle it (but ideally it's already 320kHz)
            // For now, assume the file is at correct sample rate or browser will resample
            voiceSourceNode.buffer = voiceAudioBuffer;
            
            // Connect through effects chain: source -> gain -> EQ -> filter -> distortion -> stereo width -> reverb -> destination
            voiceSourceNode.connect(voiceGain);
            voiceGain.connect(voiceEQ.low);
            voiceEQ.low.connect(voiceEQ.mid);
            voiceEQ.mid.connect(voiceEQ.high);
            voiceEQ.high.connect(voiceFilter);
            voiceFilter.connect(voiceDistortion);
            
            // Apply stereo width expansion
            const stereoExpander = applyStereoWidth(voiceDistortion);
            stereoExpander.connect(voiceReverb);
            voiceReverb.connect(audioCtx.destination);
            
            // Progress tracking
            const duration = voiceAudioBuffer.duration;
            const startTime = audioCtx.currentTime;
            const updateProgress = () => {
                if (!isSpeaking) return;
                const elapsed = audioCtx.currentTime - startTime;
                const progress = Math.min((elapsed / duration) * 100, 100);
                voiceProgressBar.style.width = progress + '%';
                if (elapsed < duration) {
                    requestAnimationFrame(updateProgress);
                }
            };
            updateProgress();
            
            // Handle end
            voiceSourceNode.onended = () => {
                stopNarration();
                voiceProgressBar.style.width = '100%';
                setTimeout(() => {
                    voiceProgressBar.style.width = '0%';
                    if (voiceStatusEl) voiceStatusEl.textContent = 'Ready';
                }, 2000);
            };
            
            voiceSourceNode.start(0);
        }

        // Stop narration
        function stopNarration() {
            isSpeaking = false;
            
            if (voiceSourceNode) {
                try {
                    voiceSourceNode.stop();
                } catch (e) {
                    // Already stopped
                }
                voiceSourceNode.disconnect();
                voiceSourceNode = null;
            }
            
            if (voiceBtn) voiceBtn.classList.remove('speaking');
            if (voiceStatusEl) {
                voiceStatusEl.textContent = 'Stopped';
                voiceStatusEl.classList.remove('speaking');
            }
            
            // Restore music level
            if (masterGain) {
                masterGain.gain.value = 0.5;
            }
        }

        // Voice button handler
        if (voiceBtn) {
            voiceBtn.addEventListener('click', () => {
                if (isSpeaking) {
                    stopNarration();
                } else {
                    startNarration();
                }
            });
        }

        // Voice is now loaded from WAV file, no need for speechSynthesis

        // 
        // SOCIAL SHARING
        // 
        
        const twitterShare = document.getElementById('twitterShare');
        const facebookShare = document.getElementById('facebookShare');
        const redditShare = document.getElementById('redditShare');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        
        const shareUrl = encodeURIComponent('https://losasbestos.com');
        const shareText = encodeURIComponent('Hinoeuma: Generative Dark Techno DJ Toolbox | Year of the Fire Horse 2026-2027');
        const shareTitle = encodeURIComponent('Year of the Fire Horse | Hinoeuma - Generative Dark Techno');
        
        // Twitter/X Share
        if (twitterShare) {
            twitterShare.addEventListener('click', (e) => {
                e.preventDefault();
                const twitterUrl = `https://twitter.com/intent/tweet?url=${shareUrl}&text=${shareText}`;
                window.open(twitterUrl, '_blank', 'width=550,height=420');
            });
        }
        
        // Facebook Share
        if (facebookShare) {
            facebookShare.addEventListener('click', (e) => {
                e.preventDefault();
                const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
                window.open(facebookUrl, '_blank', 'width=550,height=420');
            });
        }
        
        // Reddit Share
        if (redditShare) {
            redditShare.addEventListener('click', (e) => {
                e.preventDefault();
                const redditUrl = `https://reddit.com/submit?url=${shareUrl}&title=${shareTitle}`;
                window.open(redditUrl, '_blank', 'width=550,height=420');
            });
        }
        
        // Copy Link
        if (copyLinkBtn) {
            copyLinkBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText('https://losasbestos.com');
                    const originalTitle = copyLinkBtn.title;
                    copyLinkBtn.title = 'Link copied!';
                    setTimeout(() => {
                        copyLinkBtn.title = originalTitle;
                    }, 2000);
                } catch (err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = 'https://losasbestos.com';
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        const originalTitle = copyLinkBtn.title;
                        copyLinkBtn.title = 'Link copied!';
                        setTimeout(() => {
                            copyLinkBtn.title = originalTitle;
                        }, 2000);
                    } catch (err) {
                        alert('Failed to copy link. Please copy manually: ' + window.location.href);
                    }
                    document.body.removeChild(textArea);
                }
            });
        }

        // 
        // TRACK MIXER FUNCTIONS
        // 

        async function initTrackMixer() {
            if (!audioCtx) return;
            
            // Store voice buffer reference
            trackBuffers.voice = voiceAudioBuffer;
            trackGains.voice = voiceGain;
            
            // Load jungle tracks
            await loadTrackGroup('jungle', trackConfig.jungle);
            
            // Load groovy tracks
            await loadTrackGroup('groovy', trackConfig.groovy);

            // Load musicgen tracks
            await loadTrackGroup('musicgen', trackConfig.musicgen);

            // Setup UI event listeners
            setupTrackMixerControls();
        }

        async function loadTrackGroup(groupName, fileNames) {
            if (!audioCtx) return;
            
            // Get existing group gain (should already exist from initAudio)
            const groupGain = trackGroupGains[groupName];
            if (!groupGain) {
                console.warn(`Group gain for ${groupName} does not exist`);
                return;
            }
            
            for (const fileName of fileNames) {
                try {
                    const response = await fetch(fileName);
                    if (!response.ok) {
                        console.warn(`${fileName} not found, skipping`);
                        continue;
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    const buffer = await audioCtx.decodeAudioData(arrayBuffer);
                    
                    trackBuffers[groupName][fileName] = buffer;
                    
                    // Create individual gain for each track
                    const trackGain = audioCtx.createGain();
                    trackGain.gain.value = 1.0;
                    trackGains[groupName][fileName] = trackGain;
                    
                    // Connect track gain to group gain
                    trackGain.connect(groupGain);
                    
                    console.log(`Loaded ${fileName}:`, buffer.duration, 'seconds');
                } catch (error) {
                    console.warn(`Error loading ${fileName}:`, error);
                }
            }
        }

        function playTrack(groupName, fileName, loop = true) {
            if (!audioCtx || !trackBuffers[groupName] || !trackBuffers[groupName][fileName]) return null;
            
            const buffer = trackBuffers[groupName][fileName];
            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            source.loop = loop;
            
            const trackGain = trackGains[groupName][fileName];
            if (trackGain) {
                source.connect(trackGain);
                source.start(0);
            }
            
            // Store reference
            trackSources[groupName][fileName] = source;
            
            return source;
        }

        function stopTrack(groupName, fileName) {
            if (trackSources[groupName] && trackSources[groupName][fileName]) {
                try {
                    trackSources[groupName][fileName].stop();
                } catch (e) {
                    // Already stopped
                }
                trackSources[groupName][fileName].disconnect();
                delete trackSources[groupName][fileName];
            }
        }

        function setTrackVolume(groupName, fileName, volume) {
            const gain = trackGains[groupName] && trackGains[groupName][fileName];
            if (gain) {
                gain.gain.linearRampToValueAtTime(volume / 100, audioCtx.currentTime + 0.1);
            }
        }

        function setGroupVolume(groupName, volume) {
            const gain = trackGroupGains[groupName];
            if (gain) {
                gain.gain.linearRampToValueAtTime(volume / 100, audioCtx.currentTime + 0.1);
            }
        }

        function toggleGroup(groupName, enabled) {
            const gain = trackGroupGains[groupName];
            if (gain) {
                if (enabled) {
                    // Fade in
                    const currentValue = gain.gain.value;
                    const targetValue = groupName === 'voice' ? 0.8 : (groupName === 'jungle' ? 0.6 : (groupName === 'groovy' ? 0.7 : 0.75));
                    gain.gain.cancelScheduledValues(audioCtx.currentTime);
                    gain.gain.setValueAtTime(0, audioCtx.currentTime);
                    gain.gain.linearRampToValueAtTime(targetValue, audioCtx.currentTime + 0.5);
                } else {
                    // Fade out
                    gain.gain.cancelScheduledValues(audioCtx.currentTime);
                    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                }
            }
        }

        function setupTrackMixerControls() {
            // Voice track toggle and volume
            const voiceToggle = document.getElementById('trackVoiceToggle');
            const voiceVolumeSlider = document.getElementById('trackVoiceVolume');
            const voiceVolumeValue = document.getElementById('trackVoiceVolumeValue');
            
            if (voiceToggle) {
                voiceToggle.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    if (voiceGain) {
                        // Use existing voiceGain for voice group
                        if (enabled) {
                            // Fade in
                            voiceGain.gain.cancelScheduledValues(audioCtx.currentTime);
                            voiceGain.gain.setValueAtTime(0, audioCtx.currentTime);
                            const targetValue = voiceVolumeSlider ? parseInt(voiceVolumeSlider.value) / 100 : 0.8;
                            voiceGain.gain.linearRampToValueAtTime(targetValue, audioCtx.currentTime + 0.5);
                        } else {
                            // Fade out
                            voiceGain.gain.cancelScheduledValues(audioCtx.currentTime);
                            voiceGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                        }
                    }
                });
            }
            
            if (voiceVolumeSlider && voiceVolumeValue) {
                voiceVolumeSlider.addEventListener('input', (e) => {
                    const volume = parseInt(e.target.value);
                    voiceVolumeValue.textContent = volume;
                    if (voiceGain) {
                        // Update voiceGain directly
                        voiceGain.gain.linearRampToValueAtTime(volume / 100, audioCtx.currentTime + 0.1);
                    }
                });
            }
            
            // Jungle track toggle and volume
            const jungleToggle = document.getElementById('trackJungleToggle');
            const jungleVolumeSlider = document.getElementById('trackJungleVolume');
            const jungleVolumeValue = document.getElementById('trackJungleVolumeValue');
            
            if (jungleToggle) {
                jungleToggle.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    toggleGroup('jungle', enabled);
                    if (enabled) {
                        // Start enabled individual tracks
                        trackConfig.jungle.forEach((fileName, index) => {
                            const trackId = ['trackJungleAmbient', 'trackJungleBirds', 'trackJungleRain', 'trackJungleInsects'][index];
                            const trackCheckbox = document.getElementById(trackId);
                            if (trackCheckbox && trackCheckbox.checked && trackBuffers.jungle[fileName] && !trackSources.jungle[fileName]) {
                                playTrack('jungle', fileName, true);
                            }
                        });
                    } else {
                        // Stop all jungle tracks
                        Object.keys(trackSources.jungle).forEach(fileName => {
                            stopTrack('jungle', fileName);
                        });
                    }
                });
            }
            
            if (jungleVolumeSlider && jungleVolumeValue) {
                jungleVolumeSlider.addEventListener('input', (e) => {
                    const volume = parseInt(e.target.value);
                    jungleVolumeValue.textContent = volume;
                    setGroupVolume('jungle', volume);
                });
            }
            
            // Individual jungle track toggles
            const jungleTrackIds = {
                'trackJungleAmbient': 'jungle-ambient.wav',
                'trackJungleBirds': 'jungle-birds.wav',
                'trackJungleRain': 'jungle-rain.wav',
                'trackJungleInsects': 'jungle-insects.wav'
            };
            
            Object.entries(jungleTrackIds).forEach(([trackId, fileName]) => {
                const checkbox = document.getElementById(trackId);
                if (checkbox) {
                    checkbox.addEventListener('change', (e) => {
                        const enabled = e.target.checked;
                        // Check if jungle group is enabled
                        const jungleGroupEnabled = document.getElementById('trackJungleToggle')?.checked;
                        if (enabled && jungleGroupEnabled && trackBuffers.jungle[fileName]) {
                            // Start track if not already playing
                            if (!trackSources.jungle[fileName]) {
                                playTrack('jungle', fileName, true);
                            }
                        } else if (!enabled && trackSources.jungle[fileName]) {
                            // Stop track if playing
                            stopTrack('jungle', fileName);
                        }
                    });
                }
            });
            
            // Groovy track toggle and volume
            const groovyToggle = document.getElementById('trackGroovyToggle');
            const groovyVolumeSlider = document.getElementById('trackGroovyVolume');
            const groovyVolumeValue = document.getElementById('trackGroovyVolumeValue');
            
            if (groovyToggle) {
                groovyToggle.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    toggleGroup('groovy', enabled);
                    if (enabled) {
                        // Start enabled individual tracks
                        trackConfig.groovy.forEach((fileName, index) => {
                            const trackId = ['trackGroovyBass', 'trackGroovyRhythm', 'trackGroovyLead'][index];
                            const trackCheckbox = document.getElementById(trackId);
                            if (trackCheckbox && trackCheckbox.checked && trackBuffers.groovy[fileName] && !trackSources.groovy[fileName]) {
                                playTrack('groovy', fileName, true);
                            }
                        });
                    } else {
                        // Stop all groovy tracks
                        Object.keys(trackSources.groovy).forEach(fileName => {
                            stopTrack('groovy', fileName);
                        });
                    }
                });
            }
            
            if (groovyVolumeSlider && groovyVolumeValue) {
                groovyVolumeSlider.addEventListener('input', (e) => {
                    const volume = parseInt(e.target.value);
                    groovyVolumeValue.textContent = volume;
                    setGroupVolume('groovy', volume);
                });
            }
            
            // MusicGen track toggle and volume
            const musicGenToggle = document.getElementById('trackMusicGenToggle');
            const musicGenVolumeSlider = document.getElementById('trackMusicGenVolume');
            const musicGenVolumeValue = document.getElementById('trackMusicGenVolumeValue');

            if (musicGenToggle) {
                musicGenToggle.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    toggleGroup('musicgen', enabled);
                    if (enabled) {
                        // Start enabled individual tracks
                        trackConfig.musicgen.forEach((fileName) => {
                            const trackCheckbox = document.getElementById('trackMusicGenMain');
                            if (trackCheckbox && trackCheckbox.checked && trackBuffers.musicgen[fileName] && !trackSources.musicgen[fileName]) {
                                playTrack('musicgen', fileName, true);
                            }
                        });
                    } else {
                        // Stop all musicgen tracks
                        Object.keys(trackSources.musicgen).forEach(fileName => {
                            stopTrack('musicgen', fileName);
                        });
                    }
                });
            }

            if (musicGenVolumeSlider && musicGenVolumeValue) {
                musicGenVolumeSlider.addEventListener('input', (e) => {
                    const volume = e.target.value;
                    musicGenVolumeValue.textContent = volume;
                    setGroupVolume('musicgen', volume);
                });
            }

            // Individual musicgen track toggles
            const musicGenTrackCheckbox = document.getElementById('trackMusicGenMain');
            if (musicGenTrackCheckbox) {
                musicGenTrackCheckbox.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    const fileName = 'generated-music.wav';
                    const musicGenGroupEnabled = document.getElementById('trackMusicGenToggle')?.checked;
                    if (enabled && musicGenGroupEnabled && trackBuffers.musicgen[fileName]) {
                        // Start track if not already playing
                        if (!trackSources.musicgen[fileName]) {
                            playTrack('musicgen', fileName, true);
                        }
                    } else if (!enabled && trackSources.musicgen[fileName]) {
                        // Stop track if playing
                        stopTrack('musicgen', fileName);
                    }
                });
            }

            // Individual groovy track toggles
            const groovyTrackIds = {
                'trackGroovyBass': 'groovy-bass.wav',
                'trackGroovyRhythm': 'groovy-rhythm.wav',
                'trackGroovyLead': 'groovy-lead.wav'
            };

            Object.entries(groovyTrackIds).forEach(([trackId, fileName]) => {
                const checkbox = document.getElementById(trackId);
                if (checkbox) {
                    checkbox.addEventListener('change', (e) => {
                        const enabled = e.target.checked;
                        // Check if groovy group is enabled
                        const groovyGroupEnabled = document.getElementById('trackGroovyToggle')?.checked;
                        if (enabled && groovyGroupEnabled && trackBuffers.groovy[fileName]) {
                            // Start track if not already playing
                            if (!trackSources.groovy[fileName]) {
                                playTrack('groovy', fileName, true);
                            }
                        } else if (!enabled && trackSources.groovy[fileName]) {
                            // Stop track if playing
                            stopTrack('groovy', fileName);
                        }
                    });
                }
            });
        }
    </script>
    <footer style="text-align: center; padding: 2rem; color: #666; font-size: 0.875rem; font-family: inherit;">
        by Los Asbestos, 2026. Rights to distribute in support of the commons.
    </footer>
    </div>
</body>
</html>
